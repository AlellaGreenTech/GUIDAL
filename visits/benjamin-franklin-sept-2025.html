<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benjamin Franklin International - September 16, 2025 - GUIDAL</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Accordion Styles */
        .accordion-section {
            margin: 1rem 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .accordion-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .accordion-header:hover {
            background: linear-gradient(135deg, #45a049, #4CAF50);
        }

        .accordion-header h2, .accordion-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .accordion-arrow {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .accordion-content {
            display: none;
            padding: 1.5rem;
            background: white;
        }

        .accordion-content.open {
            display: block;
        }

        /* Initial state for accordions */
        #learning-objectives-content,
        #agenda-content,
        #rotation-schedule-content,
        #stations-content {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><a href="../index.html">GUIDAL</a></h1>
            <p class="subtitle">Benjamin Franklin International School Visit</p>
        </div>
    </header>
    
    <nav class="main-nav">
        <div class="container">
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="#overview">Visit Overview</a></li>
                <li><a href="#stations">Your Stations</a></li>
                <li><a href="#schedule">Schedule</a></li>
                <li><a href="../snack-bar.html">Snack Bar</a></li>
                <li><a href="#resources">Resources</a></li>
                <li><a href="#guestbook">Guest Book</a></li>
            </ul>
        </div>
    </nav>
    
    <main class="container">
        <section id="visit-header" class="visit-header">
            <div class="visit-welcome">
                <h2>Welcome Benjamin Franklin International School!</h2>
                <div class="visit-details">
                    <p><strong>Date:</strong> September 16, 2025</p>
                    <p><strong>Time:</strong> 9:00 AM - 3:00 PM</p>
                    <p><strong>Group Size:</strong> 70 Students</p>
                    <p><strong>Focus:</strong> Comprehensive Sustainability Workshop</p>
                </div>
                <div class="access-code">
                    <h4>üîë Access Code: 7530#</h4>
                    <p><small>Show this code at the gate for entry</small></p>
                </div>
            </div>
        </section>

        <section id="overview">
            <h2>Your Visit Overview</h2>

            <div class="accordion-section learning-objectives">
                <div class="accordion-header" onclick="toggleAccordion('learning-objectives')">
                    <h3>üéØ Visit Overview & Objectives</h3>
                    <span class="accordion-arrow">‚ñº</span>
                </div>
                <div class="accordion-content" id="learning-objectives-content">
                    <p><em>Today's focus is on IBDP Collaborative Sciences Projects</em></p>
                    <p>You'll explore six innovative sustainability stations covering energy storage, soil management, water systems, automation, and natural construction techniques. Each station offers hands-on learning experiences designed to demonstrate real-world applications of collaborative science.</p>

                    <h4>Learning Objectives</h4>
                    <ul>
                        <li>Understand renewable energy storage and distribution systems</li>
                        <li>Learn sustainable soil management and waste reduction techniques</li>
                        <li>Explore water conservation and natural engineering solutions</li>
                        <li>Experience agricultural automation and precision farming</li>
                        <li>Discover traditional sustainable construction methods</li>
                        <li>Apply scientific principles to environmental challenges</li>
                    </ul>

                    <h4>üéØ Your Key Inquiry Question</h4>
                    <div class="inquiry-box">
                        <p class="inquiry-text">"What innovative methods can we use to reduce water waste in our school, drawing inspiration from effective water management practices in local or global contexts?"</p>
                    </div>
                    <p class="inquiry-note">Keep this question in mind as you explore each station. You'll present your findings and solutions at the end of the day!</p>
                </div>
            </div>
        </section>

        <section id="agenda" class="agenda-section">
            <div class="accordion-section agenda-accordion">
                <div class="accordion-header" onclick="toggleAccordion('agenda')">
                    <h2>üìÖ Today's Agenda</h2>
                    <span class="accordion-arrow">‚ñº</span>
                </div>
                <div class="accordion-content" id="agenda-content">
                    <div class="agenda-table">
                        <div class="agenda-item">
                            <div class="agenda-time">8:45 AM</div>
                            <div class="agenda-activity">Meet in the cafeteria</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">8:55 AM</div>
                            <div class="agenda-activity">Walk to bus</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">9:00 AM</div>
                            <div class="agenda-activity">Leave for Alella Green Tech</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">9:30 AM</div>
                            <div class="agenda-activity">Arrive in Alella and walk to farm</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">9:45 AM</div>
                            <div class="agenda-activity">Intro Chat, Divide into groups</div>
                        </div>
                        <div class="agenda-item highlight">
                            <div class="agenda-time">10:00 AM<br><small>(2 hours)</small></div>
                            <div class="agenda-activity"><strong>Start rotations</strong><br>3 √ó 30-minute rotations with 10 mins transition time</div>
                        </div>
                        <div class="agenda-item lunch">
                            <div class="agenda-time">12:00 PM<br><small>(1 hour)</small></div>
                            <div class="agenda-activity"><strong>Lunch & Movement break</strong><br>Football in field! - Lunch will be a packed lunch</div>
                        </div>
                        <div class="agenda-item highlight">
                            <div class="agenda-time">13:00<br><small>(2 hours)</small></div>
                            <div class="agenda-activity"><strong>Finish rotations</strong><br>3 √ó 30-minute rotations with 10 mins transition time</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">15:00</div>
                            <div class="agenda-activity">Meet back together - Individual reflection?</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">15:15</div>
                            <div class="agenda-activity">Walk to the bus</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">15:30</div>
                            <div class="agenda-activity">Arrive at the bus</div>
                        </div>
                        <div class="agenda-item">
                            <div class="agenda-time">16:00</div>
                            <div class="agenda-activity">Arrive back at BFIS for dismissal</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="groups" class="groups-section">
            <h2>üë• Groups - Student Organization</h2>
            <div class="groups-info">
                <div class="group-stats">
                    <div class="stat">
                        <div class="stat-number">70</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">6</div>
                        <div class="stat-label">Groups</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">11-12</div>
                        <div class="stat-label">Students per Group</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">7</div>
                        <div class="stat-label">Accompanying Teachers</div>
                    </div>
                </div>
                <p class="groups-description">Students will rotate through 6 stations in their assigned groups. Each group will experience all stations throughout the day.</p>
            </div>
        </section>

        <section id="rotation-schedule" class="rotation-section">
            <div class="accordion-section rotation-accordion">
                <div class="accordion-header" onclick="toggleAccordion('rotation-schedule')">
                    <h2>üîÑ Rotation Schedule</h2>
                    <span class="accordion-arrow">‚ñº</span>
                </div>
                <div class="accordion-content" id="rotation-schedule-content">
                    <div class="rotation-table-container">
                        <table class="rotation-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Station 1</th>
                                    <th>Station 2</th>
                                    <th>Station 3</th>
                                    <th>Station 4</th>
                                    <th>Station 5</th>
                                    <th>Station 6</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="time-slot">10:00-10:40 AM</td>
                                    <td class="group-cell group-1">Group 1</td>
                                    <td class="group-cell group-6">Group 6</td>
                                    <td class="group-cell group-5">Group 5</td>
                                    <td class="group-cell group-4">Group 4</td>
                                    <td class="group-cell group-3">Group 3</td>
                                    <td class="group-cell group-2">Group 2</td>
                                </tr>
                                <tr>
                                    <td class="time-slot">10:40-11:20 AM</td>
                                    <td class="group-cell group-2">Group 2</td>
                                    <td class="group-cell group-1">Group 1</td>
                                    <td class="group-cell group-6">Group 6</td>
                                    <td class="group-cell group-5">Group 5</td>
                                    <td class="group-cell group-4">Group 4</td>
                                    <td class="group-cell group-3">Group 3</td>
                                </tr>
                                <tr>
                                    <td class="time-slot">11:20-12:00 PM</td>
                                    <td class="group-cell group-3">Group 3</td>
                                    <td class="group-cell group-2">Group 2</td>
                                    <td class="group-cell group-1">Group 1</td>
                                    <td class="group-cell group-6">Group 6</td>
                                    <td class="group-cell group-5">Group 5</td>
                                    <td class="group-cell group-4">Group 4</td>
                                </tr>
                                <tr class="lunch-break">
                                    <td class="time-slot">12:00-1:00 PM</td>
                                    <td colspan="6" class="lunch-cell">üçΩÔ∏è LUNCH & FOOTBALL BREAK</td>
                                </tr>
                                <tr>
                                    <td class="time-slot">1:00-1:40 PM</td>
                                    <td class="group-cell group-4">Group 4</td>
                                    <td class="group-cell group-3">Group 3</td>
                                    <td class="group-cell group-2">Group 2</td>
                                    <td class="group-cell group-1">Group 1</td>
                                    <td class="group-cell group-6">Group 6</td>
                                    <td class="group-cell group-5">Group 5</td>
                                </tr>
                                <tr>
                                    <td class="time-slot">1:40-2:20 PM</td>
                                    <td class="group-cell group-5">Group 5</td>
                                    <td class="group-cell group-4">Group 4</td>
                                    <td class="group-cell group-3">Group 3</td>
                                    <td class="group-cell group-2">Group 2</td>
                                    <td class="group-cell group-1">Group 1</td>
                                    <td class="group-cell group-6">Group 6</td>
                                </tr>
                                <tr>
                                    <td class="time-slot">2:20-3:00 PM</td>
                                    <td class="group-cell group-6">Group 6</td>
                                    <td class="group-cell group-5">Group 5</td>
                                    <td class="group-cell group-4">Group 4</td>
                                    <td class="group-cell group-3">Group 3</td>
                                    <td class="group-cell group-2">Group 2</td>
                                    <td class="group-cell group-1">Group 1</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="stations" class="stations-grid">
            <div class="accordion-section stations-accordion">
                <div class="accordion-header" onclick="toggleAccordion('stations')">
                    <h2>üß™ Your Project Stations</h2>
                    <span class="accordion-arrow">‚ñº</span>
                </div>
                <div class="accordion-content" id="stations-content">
                    <div class="station-cards">
                        <div class="station-card">
                            <h3>Planting</h3>
                            <p><strong>Station 1</strong></p>
                            <p>Hands-on experience with sustainable planting techniques, seed propagation, and understanding plant growth cycles in different environmental conditions.</p>
                            <div class="station-credits">
                                <span class="earn-credits">+5 Credits for participation</span>
                            </div>
                            <a href="../stations/planting.html" class="btn">Visit Station</a>
                        </div>

                        <div class="station-card">
                            <h3>Composting</h3>
                            <p><strong>Station 2</strong></p>
                            <p>The many ways to build good soil - learn sustainable soil creation and organic waste management techniques.</p>
                            <div class="station-credits">
                                <span class="earn-credits">+5 Credits for participation</span>
                            </div>
                            <a href="../stations/composting.html" class="btn">Visit Station</a>
                        </div>

                        <div class="station-card">
                            <h3>Robotic Gardening</h3>
                            <p><strong>Station 3</strong></p>
                            <p>Tend your garden from 1,000km away - or let the bot do it! Explore automated agriculture and precision farming.</p>
                            <div class="station-credits">
                                <span class="earn-credits">+5 Credits for participation</span>
                            </div>
                            <a href="../stations/robotic-gardening.html" class="btn">Visit Station</a>
                        </div>

                        <div class="station-card">
                            <h3>Wattle & Daub</h3>
                            <p><strong>Station 4</strong></p>
                            <p>Harvest clay, then build a home with mud, hay, and sticks - ancient sustainable construction techniques.</p>
                            <div class="station-credits">
                                <span class="earn-credits">+5 Credits for participation</span>
                            </div>
                            <a href="../stations/wattle-daub.html" class="btn">Visit Station</a>
                        </div>

                        <div class="station-card">
                            <h3>Erosion Challenge</h3>
                            <p><strong>Station 5</strong></p>
                            <p>Stop erosion, retain water and create a fertile hillside through natural engineering solutions.</p>
                            <div class="station-credits">
                                <span class="earn-credits">+5 Credits for participation</span>
                            </div>
                            <a href="../stations/erosion-challenge.html" class="btn">Visit Station</a>
                        </div>

                        <div class="station-card">
                            <h3>Pumped Hydro</h3>
                            <p><strong>Station 6</strong></p>
                            <p>Electrical energy from water - explore sustainable energy storage through gravity and water systems.</p>
                            <div class="station-credits">
                                <span class="earn-credits">+5 Credits for participation</span>
                            </div>
                            <a href="../stations/pumped-hydro.html" class="btn">Visit Station</a>
                        </div>
                    </div>

                    <div class="extra-demos">
                        <h3>Extra Demonstrations (Time Allowing)</h3>
                        <div class="demo-cards">
                            <div class="demo-card">
                                <h4>SchoolAIR</h4>
                                <p>IoT air quality and weather station project - monitor environmental conditions in real-time using sensor networks.</p>
                                <div class="demo-type">IoT & Environmental Monitoring</div>
                            </div>

                            <div class="demo-card">
                                <h4>Smart Irrigation Demo</h4>
                                <p>Automated watering systems that respond to soil moisture, weather data, and plant needs for optimal water efficiency.</p>
                                <div class="demo-type">Agricultural Technology</div>
                            </div>

                            <div class="demo-card">
                                <h4>Vineyard Disease, Wine Making & Drones</h4>
                                <p>Using drone technology to monitor vineyard health, detect diseases early, and understand the winemaking process.</p>
                                <div class="demo-type">Agricultural Innovation</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="resources">
            <h2>Additional Resources</h2>
            <div class="resource-cards">
                <div class="resource-card">
                    <h4>üì± GUIDAL Mobile App</h4>
                    <p>Download our app to track your credits, access station materials offline, and connect with other students.</p>
                    <a href="#" class="btn">Download App</a>
                </div>
                <div class="resource-card">
                    <h4>üìö Pre-Visit Reading</h4>
                    <p>Optional background materials to enhance your learning experience at each station.</p>
                    <a href="#" class="btn">View Materials</a>
                </div>
                <div class="resource-card">
                    <h4>üèÜ Credit System</h4>
                    <p>Earn credits for active participation. Use them for future visits or special experiences!</p>
                    <a href="#" class="btn">Learn More</a>
                </div>
            </div>
        </section>


        <section id="guestbook" class="guestbook-section">
            <h2>üìù Student Guest Book</h2>
            <div class="martin-welcome">
                <img src="../images/martin-welcome.png" alt="Martin with drone at Alella Green Tech" class="martin-photo">
                <p class="guestbook-intro">Hey from Martin! I hope you had a great time. Sign my guest book! Merci! üè¥Û†Å•Û†Å≥Û†Å£Û†Å¥Û†Åø</p>
            </div>
            
            <div class="guestbook-form-container">
                <form id="guestBookForm" class="guestbook-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="studentName">Your Name:</label>
                            <input type="text" id="studentName" name="studentName" required placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="studentGroup">Your Group:</label>
                            <select id="studentGroup" name="studentGroup" required>
                                <option value="">Select your group</option>
                                <option value="Group 1">Group 1</option>
                                <option value="Group 2">Group 2</option>
                                <option value="Group 3">Group 3</option>
                                <option value="Group 4">Group 4</option>
                                <option value="Group 5">Group 5</option>
                                <option value="Group 6">Group 6</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="favoriteStation">Favorite Station:</label>
                        <select id="favoriteStation" name="favoriteStation" required>
                            <option value="">Choose your favorite station</option>
                            <option value="Planting">Station 1 - Planting</option>
                            <option value="Composting">Station 2 - Composting</option>
                            <option value="Robotic Gardening">Station 3 - Robotic Gardening</option>
                            <option value="Wattle & Daub">Station 4 - Wattle & Daub</option>
                            <option value="Erosion Challenge">Station 5 - Erosion Challenge</option>
                            <option value="Pumped Hydro">Station 6 - Pumped Hydro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="studentMessage">Your Message:</label>
                        <textarea id="studentMessage" name="studentMessage" required placeholder="Share what you learned or enjoyed most about your visit..." rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="studentPhoto">Add a Photo (Optional):</label>
                        <input type="file" id="studentPhoto" name="studentPhoto" accept="image/*" capture="environment">
                        <p class="photo-help">üì∏ Take a selfie or upload a photo from today's activities!</p>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn guestbook-submit">‚úçÔ∏è Sign Guest Book</button>
                        <button type="button" id="shareInstagram" class="btn instagram-share" disabled>üì∏ Share to Instagram</button>
                    </div>
                </form>
            </div>
            
            <div class="guestbook-entries" id="guestBookEntries">
                <h3>Recent Entries</h3>
                <div class="entries-container" id="entriesContainer">
                    <div class="entry-item sample-entry">
                        <div class="entry-header">
                            <strong>Sample Student</strong> <span class="entry-group">Group 1</span>
                            <span class="entry-station">üíö Loved Robotic Gardening</span>
                        </div>
                        <p class="entry-message">"The robotic farming was amazing! I can't believe we can control plants remotely. This visit opened my eyes to sustainable technology!"</p>
                        <div class="entry-footer">
                            <span class="entry-time">Today at 2:30 PM</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            <p>&copy; 2024 Alella Green Tech. <a href="../index.html">Back to GUIDAL</a></p>
            <p><strong>Emergency Contact:</strong> +34 123 456 789 | <strong>Visit Coordinator:</strong> Maria Gonzalez</p>
        </div>
    </footer>
    
    <!-- Supabase JavaScript Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- GUIDAL Database Client -->
    <script src="../js/supabase-client.js"></script>
    
    <!-- Mobile Menu Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            if (mobileMenuToggle && navMenu) {
                mobileMenuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.main-nav')) {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    }
                });
                
                // Close menu when clicking a nav link
                const navLinks = document.querySelectorAll('.nav-menu a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    });
                });
            }

            // Accordion functionality
            window.toggleAccordion = function(accordionId) {
                const content = document.getElementById(accordionId + '-content');
                const arrow = document.querySelector(`[onclick="toggleAccordion('${accordionId}')"] .accordion-arrow`);

                if (content.style.display === 'none' || content.style.display === '') {
                    content.style.display = 'block';
                    arrow.textContent = '‚ñ≤';
                } else {
                    content.style.display = 'none';
                    arrow.textContent = '‚ñº';
                }
            };

            // Guest Book functionality
            const guestBookForm = document.getElementById('guestBookForm');
            const shareInstagram = document.getElementById('shareInstagram');
            const entriesContainer = document.getElementById('entriesContainer');
            let currentEntry = null;
            const visitAccessCode = 'bfis-sept-2025'; // BFIS visit access code

            // Load existing guest book entries on page load
            loadGuestBookEntries();

            if (guestBookForm) {
                guestBookForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(guestBookForm);
                    const name = formData.get('studentName');
                    const group = formData.get('studentGroup');
                    const station = formData.get('favoriteStation');
                    const message = formData.get('studentMessage');
                    const photo = formData.get('studentPhoto');
                    
                    try {
                        // Get visit ID by access code
                        const visit = await GuidalDB.getVisitByAccessCode(visitAccessCode);
                        if (!visit) {
                            alert('Visit not found. Please contact support.');
                            return;
                        }
                        
                        // Create new entry data
                        const entryData = {
                            visit_id: visit.id,
                            student_name: name,
                            message: message,
                            photo_url: null, // TODO: Handle photo upload later
                            instagram_handle: null
                        };
                        
                        // Save to database
                        const savedEntry = await GuidalDB.addGuestBookEntry(entryData);
                        
                        // Create entry object for display
                        const entry = {
                            id: savedEntry.id,
                            name: name,
                            group: group,
                            station: station,
                            message: message,
                            time: new Date(savedEntry.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                        };
                        
                        currentEntry = entry;
                        
                        // Add entry to the list
                        addEntryToList(entry);
                        
                        // Enable Instagram sharing
                        shareInstagram.disabled = false;
                        
                        // Show success message
                        alert('Thank you for signing our guest book! You can now share to Instagram.');
                        
                        // Reset form
                        guestBookForm.reset();
                        
                    } catch (error) {
                        console.error('Error saving guest book entry:', error);
                        alert('There was an error saving your entry. Please try again.');
                    }
                });
            }

            if (shareInstagram) {
                shareInstagram.addEventListener('click', function() {
                    if (currentEntry) {
                        shareToInstagram(currentEntry);
                    }
                });
            }

            async function loadGuestBookEntries() {
                try {
                    // Get visit by access code
                    const visit = await GuidalDB.getVisitByAccessCode(visitAccessCode);
                    if (!visit) return;
                    
                    // Get entries for this visit
                    const entries = await GuidalDB.getGuestBookEntries(visit.id);
                    
                    // Clear existing entries (except sample)
                    const existingEntries = entriesContainer.querySelectorAll('.entry-item:not(.sample-entry)');
                    existingEntries.forEach(entry => entry.remove());
                    
                    // Add each entry to the display
                    entries.forEach(dbEntry => {
                        const entry = {
                            id: dbEntry.id,
                            name: dbEntry.student_name,
                            group: 'Student', // Could add group field to DB later
                            station: 'Various Stations',
                            message: dbEntry.message,
                            time: new Date(dbEntry.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                        };
                        addEntryToList(entry, false); // Don't animate existing entries
                    });
                    
                    // Set up real-time subscription for new entries
                    GuidalDB.subscribeToGuestBookEntries(handleNewGuestBookEntry, visit.id);
                    
                } catch (error) {
                    console.error('Error loading guest book entries:', error);
                }
            }
            
            function handleNewGuestBookEntry(payload) {
                if (payload.eventType === 'INSERT') {
                    const dbEntry = payload.new;
                    const entry = {
                        id: dbEntry.id,
                        name: dbEntry.student_name,
                        group: 'Student',
                        station: 'Various Stations',
                        message: dbEntry.message,
                        time: new Date(dbEntry.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    };
                    addEntryToList(entry, true); // Animate new entries
                }
            }

            function addEntryToList(entry, animate = true) {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'entry-item';
                entryDiv.dataset.entryId = entry.id;
                
                entryDiv.innerHTML = `
                    <div class="entry-header">
                        <strong>${entry.name}</strong> 
                        <span class="entry-group">${entry.group}</span>
                        <span class="entry-station">üíö Loved ${entry.station}</span>
                    </div>
                    <p class="entry-message">"${entry.message}"</p>
                    <div class="entry-footer">
                        <span class="entry-time">Today at ${entry.time}</span>
                    </div>
                `;
                
                // Insert at the beginning (after sample entry)
                const sampleEntry = entriesContainer.querySelector('.sample-entry');
                if (sampleEntry && sampleEntry.nextSibling) {
                    entriesContainer.insertBefore(entryDiv, sampleEntry.nextSibling);
                } else {
                    entriesContainer.appendChild(entryDiv);
                }
                
                // Animate in if requested
                if (animate) {
                    entryDiv.style.opacity = '0';
                    entryDiv.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        entryDiv.style.transition = 'all 0.5s ease';
                        entryDiv.style.opacity = '1';
                        entryDiv.style.transform = 'translateY(0)';
                    }, 100);
                }
            }

            function shareToInstagram(entry) {
                // Create a shareable message
                const message = `Amazing day at Alella Green Tech! üå±\n\nMy favorite station: ${entry.station}\n\n"${entry.message}"\n\n#AlellaGreenTech #Sustainability #BFIS #GreenTechnology #StudentLife`;
                
                // Try to use Instagram's native sharing if available
                if (navigator.share) {
                    navigator.share({
                        title: 'My Visit to Alella Green Tech',
                        text: message,
                        url: window.location.href
                    }).catch(err => {
                        console.log('Error sharing:', err);
                        fallbackInstagramShare(message);
                    });
                } else {
                    fallbackInstagramShare(message);
                }
            }

            function fallbackInstagramShare(message) {
                // Copy message to clipboard and show instructions
                navigator.clipboard.writeText(message).then(() => {
                    alert(`Message copied to clipboard! üìã\n\nTo share on Instagram:\n1. Open Instagram app\n2. Create a new post or story\n3. Add your photo\n4. Paste this message as your caption\n5. Tag @allellagreentech if you want!`);
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = message;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('Message copied! Open Instagram and paste as your caption.');
                });
            }

        });
    </script>
</body>
</html>