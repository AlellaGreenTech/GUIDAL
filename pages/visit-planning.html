<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Your Visit - GUIDAL</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        .visit-header {
            background: linear-gradient(rgba(33, 150, 243, 0.7), rgba(21, 101, 192, 0.7)), url('../images/school-visit-bg.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
            padding: 3rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }

        .visit-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .visit-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .agenda-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 0 8px 8px 0;
        }

        .agenda-info h3 {
            margin-top: 0;
            color: #1565c0;
        }

        .agenda-info ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .agenda-info li {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .form-section h3 {
            color: #2196f3;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196f3;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .radio-option {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #2196f3;
            background: #f8f9fa;
        }

        .radio-option input[type="radio"] {
            margin-top: 0.25rem;
            width: auto;
        }

        .radio-option.selected {
            border-color: #2196f3;
            background: #e3f2fd;
        }

        .radio-text {
            flex: 1;
        }

        .radio-text strong {
            display: block;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .radio-text small {
            color: #666;
            font-size: 0.9rem;
        }

        .workshop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .workshop-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .workshop-card:hover {
            border-color: #2196f3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
        }

        .workshop-card.selected {
            border-color: #2196f3;
            background: #e3f2fd;
        }

        .workshop-card input[type="checkbox"] {
            margin-right: 0.5rem;
            width: auto;
        }

        .workshop-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .workshop-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .workshop-details {
            font-size: 0.8rem;
            color: #777;
        }

        .required-field::after {
            content: " *";
            color: #f44336;
        }

        .submit-btn {
            background: #2196f3;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 2rem;
        }

        .submit-btn:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Visit Type Selection Styles */
        .visit-type-options {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .visit-type-option {
            display: block;
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .visit-type-option:hover:not(.disabled) {
            border-color: #2196f3;
            background: #f8fcff;
        }

        .visit-type-option.active {
            border-color: #2196f3;
            background: #e3f2fd;
        }

        .visit-type-option.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #f9f9f9;
        }

        .visit-type-option input[type="radio"] {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 20px;
            height: 20px;
        }

        .option-content h4 {
            margin: 0 0 0.5rem 0;
            color: #2196f3;
            font-size: 1.2rem;
        }

        .option-content p {
            margin: 0;
            color: #666;
            font-size: 0.95rem;
        }

        .visit-type-option.disabled .option-content h4,
        .visit-type-option.disabled .option-content p {
            color: #999;
        }

        .loading, .success-message, .error-message {
            display: none;
            text-align: center;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 8px;
        }

        .success-message {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            color: #2e7d32;
        }

        .error-message {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
        }

        .other-input {
            display: none;
            margin-top: 0.5rem;
        }

        .other-input.visible {
            display: block;
        }

        /* Accommodation Selection Styles */
        .accommodation-options {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .accommodation-option {
            display: block;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
        }

        .accommodation-option:hover {
            border-color: #2196f3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
        }

        .accommodation-option input[type="radio"] {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 20px;
            height: 20px;
        }

        .accommodation-option input[type="radio"]:checked + .accommodation-content {
            color: #333;
        }

        /* Modern browsers with :has() support */
        .accommodation-option:has(input[type="radio"]:checked) {
            border-color: #2196f3;
            background: #e3f2fd;
        }

        /* Fallback for browsers without :has() support */
        .accommodation-option.selected {
            border-color: #2196f3;
            background: #e3f2fd;
        }

        .accommodation-content {
            margin-right: 2rem;
        }

        .accommodation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .accommodation-header h4 {
            margin: 0;
            color: #2196f3;
            font-size: 1.1rem;
        }

        .capacity-badge {
            background: #f0f8ff;
            color: #1976d2;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid #e3f2fd;
        }

        .accommodation-description {
            margin: 0.5rem 0;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .accommodation-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.75rem 0;
        }

        .feature {
            background: #f8f9fa;
            color: #555;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            border: 1px solid #e9ecef;
        }

        .accommodation-details {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #f0f0f0;
        }

        .accommodation-details small {
            color: #777;
            font-size: 0.8rem;
        }

        /* Accordion Styles */
        .accordion-section {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .accordion-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2196f3;
            transition: background-color 0.3s ease;
        }

        .accordion-header:hover {
            background: #e3f2fd;
        }

        .accordion-header.active {
            background: #e3f2fd;
            border-bottom: 1px solid #e0e0e0;
        }

        .accordion-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .accordion-content.active {
            max-height: 2000px;
        }

        .accordion-inner {
            padding: 1.5rem;
        }

        /* Special styling for visit type accordion - always show fully */
        .visit-type-accordion .accordion-content.active {
            max-height: none !important;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .workshop-grid {
                grid-template-columns: 1fr;
            }

            .visit-header {
                padding: 1.5rem 0;
            }

            .visit-header h1 {
                font-size: 0;
            }

            .visit-header h1::before {
                content: "Plan Your Visit";
                font-size: 1.75rem;
            }

            .visit-subtitle {
                display: none;
            }

            .radio-group {
                gap: 0.5rem;
            }

            .accommodation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .accommodation-features {
                gap: 0.25rem;
            }

            .feature {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
            }
        }
    </style>
</head>
<body>

    <nav class="main-nav">
        <div class="container" style="display: flex; align-items: center; gap: 2rem;">
            <a href="../index.html" style="text-decoration: none; display: flex; align-items: center; padding: 0.75rem 0;">
                <span style="font-size: 1.5rem; font-weight: bold; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">GUIDAL</span>
            </a>
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <ul class="nav-menu" style="flex: 1;">
                <li><a href="directions.html">Directions</a></li>
                <li><a href="activities.html">Activities</a></li>
                <li><a href="kits.html">Kits</a></li>
                <li><a href="visit-planning.html" class="active">Plan Visit</a></li>
                <li><a href="follow-post.html">Follow & Share</a></li>
                <li><a href="https://alellagreentech.com/testimonials/" target="_blank">Blog</a></li>
                <li><a href="auth/login.html" class="login-btn">Login/Register</a></li>
            </ul>
        </div>
    </nav>

    <div class="visit-header">
        <div class="container">
            <h1>🎓 Plan Your Group's Visit</h1>
            <p class="visit-subtitle">Plan the perfect learning experience for you, your family or your students</p>
        </div>
    </div>

    <main class="container">
        <div class="form-container">
            <form id="visitPlanningForm">
                <!-- Visit Type Selection -->
                <div class="accordion-section visit-type-accordion">
                    <button type="button" class="accordion-header active">
                        <span>🎯 What type of visit do you plan?</span>
                        <span class="accordion-icon">▼</span>
                    </button>
                    <div class="accordion-content active">
                        <div class="accordion-inner">
                            <p>Please select the type of educational experience you're planning:</p>

                            <div class="visit-type-options">
                        <label class="visit-type-option active">
                            <input type="radio" name="visitType" value="school_day_trip" checked>
                            <div class="option-content">
                                <h4>🏫 School Day Field Trip</h4>
                                <p>Traditional one-day educational visit (10am-3:30pm)</p>
                            </div>
                        </label>

                        <label class="visit-type-option">
                            <input type="radio" name="visitType" value="school_overnight">
                            <div class="option-content">
                                <h4>🏕️ School Overnight Field Trip</h4>
                                <p>Multi-day immersive experience with accommodation</p>
                            </div>
                        </label>

                        <label class="visit-type-option">
                            <input type="radio" name="visitType" value="family_visit">
                            <div class="option-content">
                                <h4>👨‍👩‍👧‍👦 Family Visit</h4>
                                <p>Fun & educational family activities</p>
                            </div>
                        </label>

                        <label class="visit-type-option disabled">
                            <input type="radio" name="visitType" value="individual_workshops" disabled>
                            <div class="option-content">
                                <h4>🔬 Individual Workshops</h4>
                                <p>Single workshop sessions (Coming Soon)</p>
                            </div>
                        </label>

                        <label class="visit-type-option disabled">
                            <input type="radio" name="visitType" value="event" disabled>
                            <div class="option-content">
                                <h4>🌱 Special Event</h4>
                                <p>Community events and celebrations (Coming Soon)</p>
                            </div>
                        </label>

                        <label class="visit-type-option disabled">
                            <input type="radio" name="visitType" value="special_lunch" disabled>
                            <div class="option-content">
                                <h4>🍽️ Special Lunch Experience</h4>
                                <p>Culinary education with meal preparation (Coming Soon)</p>
                            </div>
                        </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Day Trip Schedule (shown by default since day trip is selected) -->
                <div id="dayTripSchedule" class="agenda-info" style="display: block;">
                    <h3>📅 Typical Visit Schedule</h3>
                    <ul>
                        <li><strong>10:00</strong> INTRO chat - Welcome and introduction to the site</li>
                        <li><strong>10:15</strong> START - Groups rotate between demo stations or take a general tour</li>
                        <li><strong>13:00</strong> LUNCH at the Techlounge bbq and pizza oven area - Chef's wood fire pizza! (if lunch is included)</li>
                        <li><strong>14:00</strong> HANDS ON time! Digging, planting, landscaping, etc.</li>
                        <li><strong>15:30</strong> END - Walk to the bus! Often there is time for students to enjoy romping on the natural grass field</li>
                    </ul>
                    <p><em>Schedule can be adapted based on your group's needs and selected format.</em></p>
                </div>

                <!-- Contact Information Section -->
                <div class="form-section">
                    <h3>👋 Contact Information</h3>

                    <!-- Organizer Contact -->
                    <div class="accordion-section">
                        <button type="button" class="accordion-header">
                            <span>📋 Organizer Contact (Optional)</span>
                            <span class="accordion-icon">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="accordion-inner">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="organizerName">Organizer Name</label>
                                        <input type="text" id="organizerName" name="organizerName" placeholder="Full name of trip organizer">
                                    </div>
                                    <div class="form-group">
                                        <label for="organizerEmail">Organizer Email</label>
                                        <input type="email" id="organizerEmail" name="organizerEmail" placeholder="organizer@school.edu">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="organizerPhone">Organizer Phone Number</label>
                                    <input type="tel" id="organizerPhone" name="organizerPhone" placeholder="+34 123 456 789">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lead Teacher Contact -->
                    <div class="accordion-section">
                        <button type="button" class="accordion-header active">
                            <span>👨‍🏫 Lead Teacher Contact *</span>
                            <span class="accordion-icon">▼</span>
                        </button>
                        <div class="accordion-content active">
                            <div class="accordion-inner">
                                <div class="form-group">
                                    <label for="leadTeacherName" class="required-field">Lead Teacher Name</label>
                                    <input type="text" id="leadTeacherName" name="leadTeacherName" placeholder="Full name and position" required>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="leadTeacherEmail" class="required-field">Lead Teacher Email</label>
                                        <input type="email" id="leadTeacherEmail" name="leadTeacherEmail" placeholder="teacher@school.edu" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="leadTeacherPhone" class="required-field">Lead Teacher Phone</label>
                                        <input type="tel" id="leadTeacherPhone" name="leadTeacherPhone" placeholder="+34 123 456 789" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- School Information -->
                    <h4 style="color: #1976d2; margin: 2rem 0 1rem 0; font-size: 1.1rem;">School Information</h4>

                    <div class="form-group">
                        <label for="schoolName" class="required-field">School/Organization Name</label>
                        <input type="text" id="schoolName" name="schoolName" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="city" class="required-field">City</label>
                            <input type="text" id="city" name="city" placeholder="e.g., Barcelona" required>
                        </div>
                        <div class="form-group">
                            <label for="country" class="required-field">Country</label>
                            <select id="country" name="country" required>
                                <option value="">Select country</option>
                                <option value="Afghanistan">Afghanistan</option>
                                <option value="Albania">Albania</option>
                                <option value="Algeria">Algeria</option>
                                <option value="Andorra">Andorra</option>
                                <option value="Angola">Angola</option>
                                <option value="Argentina">Argentina</option>
                                <option value="Armenia">Armenia</option>
                                <option value="Australia">Australia</option>
                                <option value="Austria">Austria</option>
                                <option value="Azerbaijan">Azerbaijan</option>
                                <option value="Bahrain">Bahrain</option>
                                <option value="Bangladesh">Bangladesh</option>
                                <option value="Belarus">Belarus</option>
                                <option value="Belgium">Belgium</option>
                                <option value="Belize">Belize</option>
                                <option value="Benin">Benin</option>
                                <option value="Bhutan">Bhutan</option>
                                <option value="Bolivia">Bolivia</option>
                                <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                                <option value="Botswana">Botswana</option>
                                <option value="Brazil">Brazil</option>
                                <option value="Brunei">Brunei</option>
                                <option value="Bulgaria">Bulgaria</option>
                                <option value="Burkina Faso">Burkina Faso</option>
                                <option value="Burundi">Burundi</option>
                                <option value="Cambodia">Cambodia</option>
                                <option value="Cameroon">Cameroon</option>
                                <option value="Canada">Canada</option>
                                <option value="Cape Verde">Cape Verde</option>
                                <option value="Central African Republic">Central African Republic</option>
                                <option value="Chad">Chad</option>
                                <option value="Chile">Chile</option>
                                <option value="China">China</option>
                                <option value="Colombia">Colombia</option>
                                <option value="Comoros">Comoros</option>
                                <option value="Congo">Congo</option>
                                <option value="Costa Rica">Costa Rica</option>
                                <option value="Croatia">Croatia</option>
                                <option value="Cuba">Cuba</option>
                                <option value="Cyprus">Cyprus</option>
                                <option value="Czech Republic">Czech Republic</option>
                                <option value="Denmark">Denmark</option>
                                <option value="Djibouti">Djibouti</option>
                                <option value="Dominica">Dominica</option>
                                <option value="Dominican Republic">Dominican Republic</option>
                                <option value="Ecuador">Ecuador</option>
                                <option value="Egypt">Egypt</option>
                                <option value="El Salvador">El Salvador</option>
                                <option value="Equatorial Guinea">Equatorial Guinea</option>
                                <option value="Eritrea">Eritrea</option>
                                <option value="Estonia">Estonia</option>
                                <option value="Eswatini">Eswatini</option>
                                <option value="Ethiopia">Ethiopia</option>
                                <option value="Fiji">Fiji</option>
                                <option value="Finland">Finland</option>
                                <option value="France">France</option>
                                <option value="Gabon">Gabon</option>
                                <option value="Gambia">Gambia</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Germany">Germany</option>
                                <option value="Ghana">Ghana</option>
                                <option value="Greece">Greece</option>
                                <option value="Grenada">Grenada</option>
                                <option value="Guatemala">Guatemala</option>
                                <option value="Guinea">Guinea</option>
                                <option value="Guinea-Bissau">Guinea-Bissau</option>
                                <option value="Guyana">Guyana</option>
                                <option value="Haiti">Haiti</option>
                                <option value="Honduras">Honduras</option>
                                <option value="Hungary">Hungary</option>
                                <option value="Iceland">Iceland</option>
                                <option value="India">India</option>
                                <option value="Indonesia">Indonesia</option>
                                <option value="Iran">Iran</option>
                                <option value="Iraq">Iraq</option>
                                <option value="Ireland">Ireland</option>
                                <option value="Israel">Israel</option>
                                <option value="Italy">Italy</option>
                                <option value="Jamaica">Jamaica</option>
                                <option value="Japan">Japan</option>
                                <option value="Jordan">Jordan</option>
                                <option value="Kazakhstan">Kazakhstan</option>
                                <option value="Kenya">Kenya</option>
                                <option value="Kiribati">Kiribati</option>
                                <option value="Korea, North">Korea, North</option>
                                <option value="Korea, South">Korea, South</option>
                                <option value="Kuwait">Kuwait</option>
                                <option value="Kyrgyzstan">Kyrgyzstan</option>
                                <option value="Laos">Laos</option>
                                <option value="Latvia">Latvia</option>
                                <option value="Lebanon">Lebanon</option>
                                <option value="Lesotho">Lesotho</option>
                                <option value="Liberia">Liberia</option>
                                <option value="Libya">Libya</option>
                                <option value="Liechtenstein">Liechtenstein</option>
                                <option value="Lithuania">Lithuania</option>
                                <option value="Luxembourg">Luxembourg</option>
                                <option value="Madagascar">Madagascar</option>
                                <option value="Malawi">Malawi</option>
                                <option value="Malaysia">Malaysia</option>
                                <option value="Maldives">Maldives</option>
                                <option value="Mali">Mali</option>
                                <option value="Malta">Malta</option>
                                <option value="Marshall Islands">Marshall Islands</option>
                                <option value="Mauritania">Mauritania</option>
                                <option value="Mauritius">Mauritius</option>
                                <option value="Mexico">Mexico</option>
                                <option value="Micronesia">Micronesia</option>
                                <option value="Moldova">Moldova</option>
                                <option value="Monaco">Monaco</option>
                                <option value="Mongolia">Mongolia</option>
                                <option value="Montenegro">Montenegro</option>
                                <option value="Morocco">Morocco</option>
                                <option value="Mozambique">Mozambique</option>
                                <option value="Myanmar">Myanmar</option>
                                <option value="Namibia">Namibia</option>
                                <option value="Nauru">Nauru</option>
                                <option value="Nepal">Nepal</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="New Zealand">New Zealand</option>
                                <option value="Nicaragua">Nicaragua</option>
                                <option value="Niger">Niger</option>
                                <option value="Nigeria">Nigeria</option>
                                <option value="North Macedonia">North Macedonia</option>
                                <option value="Norway">Norway</option>
                                <option value="Oman">Oman</option>
                                <option value="Pakistan">Pakistan</option>
                                <option value="Palau">Palau</option>
                                <option value="Palestine">Palestine</option>
                                <option value="Panama">Panama</option>
                                <option value="Papua New Guinea">Papua New Guinea</option>
                                <option value="Paraguay">Paraguay</option>
                                <option value="Peru">Peru</option>
                                <option value="Philippines">Philippines</option>
                                <option value="Poland">Poland</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Qatar">Qatar</option>
                                <option value="Romania">Romania</option>
                                <option value="Russia">Russia</option>
                                <option value="Rwanda">Rwanda</option>
                                <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                                <option value="Saint Lucia">Saint Lucia</option>
                                <option value="Saint Vincent and the Grenadines">Saint Vincent and the Grenadines</option>
                                <option value="Samoa">Samoa</option>
                                <option value="San Marino">San Marino</option>
                                <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                                <option value="Saudi Arabia">Saudi Arabia</option>
                                <option value="Senegal">Senegal</option>
                                <option value="Serbia">Serbia</option>
                                <option value="Seychelles">Seychelles</option>
                                <option value="Sierra Leone">Sierra Leone</option>
                                <option value="Singapore">Singapore</option>
                                <option value="Slovakia">Slovakia</option>
                                <option value="Slovenia">Slovenia</option>
                                <option value="Solomon Islands">Solomon Islands</option>
                                <option value="Somalia">Somalia</option>
                                <option value="South Africa">South Africa</option>
                                <option value="South Sudan">South Sudan</option>
                                <option value="Spain">Spain</option>
                                <option value="Sri Lanka">Sri Lanka</option>
                                <option value="Sudan">Sudan</option>
                                <option value="Suriname">Suriname</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="Syria">Syria</option>
                                <option value="Taiwan">Taiwan</option>
                                <option value="Tajikistan">Tajikistan</option>
                                <option value="Tanzania">Tanzania</option>
                                <option value="Thailand">Thailand</option>
                                <option value="Timor-Leste">Timor-Leste</option>
                                <option value="Togo">Togo</option>
                                <option value="Tonga">Tonga</option>
                                <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                                <option value="Tunisia">Tunisia</option>
                                <option value="Turkey">Turkey</option>
                                <option value="Turkmenistan">Turkmenistan</option>
                                <option value="Tuvalu">Tuvalu</option>
                                <option value="Uganda">Uganda</option>
                                <option value="Ukraine">Ukraine</option>
                                <option value="United Arab Emirates">United Arab Emirates</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="United States">United States</option>
                                <option value="Uruguay">Uruguay</option>
                                <option value="Uzbekistan">Uzbekistan</option>
                                <option value="Vanuatu">Vanuatu</option>
                                <option value="Vatican City">Vatican City</option>
                                <option value="Venezuela">Venezuela</option>
                                <option value="Vietnam">Vietnam</option>
                                <option value="Yemen">Yemen</option>
                                <option value="Zambia">Zambia</option>
                                <option value="Zimbabwe">Zimbabwe</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Visit Planning Section -->
                <div class="form-section">
                    <h3>📅 Visit Planning</h3>

                    <div class="form-group">
                        <label for="proposedVisitDate" class="required-field">Proposed Visit Date</label>
                        <input type="date" id="proposedVisitDate" name="proposedVisitDate" required>
                    </div>

                    <div class="form-group">
                        <label for="visitDates">Alternative dates considered</label>
                        <textarea id="visitDates" name="visitDates" rows="3" placeholder="Please provide alternative dates or time periods you would consider (e.g., 'Any time in March 2025', 'Week of April 15th', etc.)"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="language">Preferred Language</label>
                            <select id="language" name="language">
                                <option value="">Select language</option>
                                <option value="english">English</option>
                                <option value="spanish">Spanish</option>
                                <option value="catalan">Catalan</option>
                                <option value="french">French</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="languageOther" style="opacity: 0;">Other Language</label>
                            <input type="text" id="languageOther" name="languageOther" placeholder="Specify other language" style="display: none;">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="studentCount" class="required-field">Number of Students</label>
                            <input type="number" id="studentCount" name="studentCount" min="1" max="100" required>
                        </div>
                        <div class="form-group">
                            <label for="gradeLevel" class="required-field">Grade Level</label>
                            <select id="gradeLevel" name="gradeLevel" required>
                                <option value="">Select grade level...</option>
                                <option value="Elementary (K-5)">Elementary (K-5)</option>
                                <option value="Middle School (6-8)">Middle School (6-8)</option>
                                <option value="High School (9-12)">High School (9-12)</option>
                                <option value="University/College">University/College</option>
                                <option value="Mixed Ages">Mixed Ages</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="adultCount">Number of Accompanying Adults</label>
                            <input type="number" id="adultCount" name="adultCount" min="0" max="20">
                        </div>
                    </div>

                    <!-- Overnight-specific fields (hidden by default) -->
                    <div id="overnightFields" style="display: none;">
                        <h4 style="color: #1976d2; margin: 2rem 0 1rem 0; font-size: 1.1rem;">🏕️ Overnight Stay Details</h4>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="numberOfNights">Number of Nights</label>
                                <select id="numberOfNights" name="numberOfNights">
                                    <option value="">Select nights</option>
                                    <option value="1">1 night</option>
                                    <option value="2">2 nights</option>
                                    <option value="3">3 nights</option>
                                    <option value="4">4 nights</option>
                                    <option value="5">5 nights</option>
                                    <option value="other">More than 5 nights</option>
                                </select>
                            </div>
                            <div class="form-group" id="customNightsGroup" style="display: none;">
                                <label for="customNights">Number of Nights</label>
                                <input type="number" id="customNights" name="customNights" min="1" max="30" placeholder="Enter number of nights">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="arrivalDateTime">Arrival Date & Time</label>
                                <input type="datetime-local" id="arrivalDateTime" name="arrivalDateTime">
                            </div>
                            <div class="form-group">
                                <label for="departureDateTime">Departure Date & Time</label>
                                <input type="datetime-local" id="departureDateTime" name="departureDateTime">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="accommodationSelection">Accommodation Preference</label>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">Choose your preferred accommodation option for your overnight stay. All accommodations are available at no additional cost.</p>

                            <div class="accommodation-options">
                                <label class="accommodation-option">
                                    <input type="radio" name="accommodationSelection" value="fort_flappy">
                                    <div class="accommodation-content">
                                        <div class="accommodation-header">
                                            <h4>🏕️ Fort Flappy (The Tent)</h4>
                                            <span class="capacity-badge">Up to 12 people</span>
                                        </div>
                                        <p class="accommodation-description">Military field tent with flexible configuration. Can be set up as up to 4 separate bedrooms or one large communal space.</p>
                                        <div class="accommodation-features">
                                            <span class="feature">🌡️ Climate Controlled</span>
                                            <span class="feature">💨 AC & Heating</span>
                                            <span class="feature">⚡ Electricity</span>
                                            <span class="feature">📶 Fast Internet</span>
                                            <span class="feature">🔧 Configurable Layout</span>
                                        </div>
                                        <div class="accommodation-details">
                                            <small><strong>Capacity:</strong> Up to 6 adults or 12 children (max 12 total) • <strong>Size:</strong> 30m²</small>
                                        </div>
                                    </div>
                                </label>

                                <label class="accommodation-option">
                                    <input type="radio" name="accommodationSelection" value="liberation_lodge">
                                    <div class="accommodation-content">
                                        <div class="accommodation-header">
                                            <h4>🚐 Liberation Lodge (The Caravan)</h4>
                                            <span class="capacity-badge">Up to 4 people</span>
                                        </div>
                                        <p class="accommodation-description">Comfortable caravan with 2 bedrooms, kitchenette, and full bathroom facilities. Perfect for smaller groups or families.</p>
                                        <div class="accommodation-features">
                                            <span class="feature">🍳 Kitchenette</span>
                                            <span class="feature">🚿 Bathroom & Shower</span>
                                            <span class="feature">🔥 Hot Water</span>
                                            <span class="feature">⚡ Electricity</span>
                                            <span class="feature">🏠 2 Bedrooms</span>
                                        </div>
                                        <div class="accommodation-details">
                                            <small><strong>Capacity:</strong> Up to 4 adults or 4 children (max 4 total) • <strong>Rooms:</strong> 2 bedrooms, 1 bathroom, kitchen</small>
                                        </div>
                                    </div>
                                </label>

                                <label class="accommodation-option">
                                    <input type="radio" name="accommodationSelection" value="dirt_cheap_cabin">
                                    <div class="accommodation-content">
                                        <div class="accommodation-header">
                                            <h4>🏠 The Presidential Shack (The Mud House)</h4>
                                            <span class="capacity-badge">Up to 2 people</span>
                                        </div>
                                        <p class="accommodation-description">Eco-friendly mud house construction. Small but comfortable space with excellent natural climate control.</p>
                                        <div class="accommodation-features">
                                            <span class="feature">🌱 Eco-Friendly</span>
                                            <span class="feature">🌡️ Natural Climate Control</span>
                                            <span class="feature">💨 Air Conditioning</span>
                                            <span class="feature">📶 Internet</span>
                                            <span class="feature">❄️ Cool in Summer</span>
                                        </div>
                                        <div class="accommodation-details">
                                            <small><strong>Capacity:</strong> Up to 2 people • <strong>Size:</strong> 12m² • <strong>Note:</strong> Cool in summer, warm in winter</small>
                                        </div>
                                    </div>
                                </label>

                                <label class="accommodation-option">
                                    <input type="radio" name="accommodationSelection" value="your_tent">
                                    <div class="accommodation-content">
                                        <div class="accommodation-header">
                                            <h4>⛺ Your Tent(s)!</h4>
                                            <span class="capacity-badge">Bring your own</span>
                                        </div>
                                        <p class="accommodation-description">Pitch your tent in our natural woods and make use of our excellent glamping kitchen, laundry and shower/bathrooms.</p>
                                        <div class="accommodation-features">
                                            <span class="feature">🌲 Natural Woods Setting</span>
                                            <span class="feature">🍳 Glamping Kitchen</span>
                                            <span class="feature">🧺 Laundry Facilities</span>
                                            <span class="feature">🚿 Shower & Bathrooms</span>
                                            <span class="feature">⛺ Bring Your Own Tent</span>
                                        </div>
                                        <div class="accommodation-details">
                                            <small><strong>Capacity:</strong> Variable (based on your tents) • <strong>Setting:</strong> Natural woodland camping</small>
                                        </div>
                                    </div>
                                </label>

                                <label class="accommodation-option">
                                    <input type="radio" name="accommodationSelection" value="no_preference">
                                    <div class="accommodation-content">
                                        <div class="accommodation-header">
                                            <h4>🤷 No Preference</h4>
                                        </div>
                                        <p class="accommodation-description">Let us choose the best accommodation based on your group size and needs.</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="accommodationNeeds">Additional Accommodation Requirements</label>
                            <textarea id="accommodationNeeds" name="accommodationNeeds" rows="3" placeholder="Any specific accommodation needs, sleeping arrangements, accessibility requirements, or special requests..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Visit Format Section - Day Trips -->
                <div class="form-section" id="dayTripFormatSection">
                    <h3>⏰ Visit Format</h3>
                    <p>Are you planning a full day or just a morning session with lunch?</p>

                    <div class="radio-group" id="visitFormatGroup">
                        <label class="radio-option">
                            <input type="radio" name="visitFormat" value="full_day_pizza_lunch">
                            <div class="radio-text">
                                <strong>Full day with pizza lunch included</strong>
                                <small>Usually the hours are 10am to 3:30pm</small>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="visitFormat" value="morning_no_lunch">
                            <div class="radio-text">
                                <strong>Just the morning with no lunch</strong>
                                <small>Visit ends 1300 or 1330</small>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="visitFormat" value="morning_with_lunch">
                            <div class="radio-text">
                                <strong>Just the morning with lunch</strong>
                                <small>We depart right after lunch (1400 or 1430)</small>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="visitFormat" value="other">
                            <div class="radio-text">
                                <strong>Other:</strong>
                            </div>
                        </label>
                        <input type="text" class="other-input" id="visitFormatOther" name="visitFormatOther" placeholder="Please specify your preferred format">
                    </div>
                </div>

                <!-- Educational Focus Section -->
                <div class="form-section">
                    <h3>🎯 Educational Focus</h3>
                    <p>Many schools ask for their students to see science in action (which implies an in depth tour of salient parts of our center) whilst other ask for the focus to be entirely on hands on work such as permaculture gardening or water retention landscaping. If you leave it to us, we'll have a healthy mixture of both. See and DO!</p>

                    <div class="radio-group" id="educationalFocusGroup">
                        <label class="radio-option">
                            <input type="radio" name="educationalFocus" value="seeing_real_world_science">
                            <div class="radio-text">
                                <strong>We prefer seeing real world examples that relate to things learnt about at school/homeschooling</strong>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="educationalFocus" value="hands_on_permaculture">
                            <div class="radio-text">
                                <strong>We prefer a very hands on visit where kids work with the land, water, plants, & soil following permaculture</strong>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="educationalFocus" value="balanced_mix">
                            <div class="radio-text">
                                <strong>We prefer a balanced mix of seeing things and doing things</strong>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="educationalFocus" value="other">
                            <div class="radio-text">
                                <strong>Other:</strong>
                            </div>
                        </label>
                        <input type="text" class="other-input" id="educationalFocusOther" name="educationalFocusOther" placeholder="Please specify your educational focus preference">
                    </div>
                </div>

                <!-- Science-in-Action Station Selection -->
                <div class="form-section">
                    <h3>🔬 Science-in-Action Station Selection</h3>
                    <p>Select the stations you'd like to include in your visit. We'll work together to determine which ones fit best with your group size, time constraints, and learning objectives.</p>

                    <div id="workshopGrid" class="workshop-grid">
                        <!-- Science stations will be loaded dynamically -->
                    </div>
                </div>

                <!-- Overnight Schedule Section -->
                <div class="form-section" id="overnightScheduleSection" style="display: none;">
                    <h3>⏰ Schedule Your Time</h3>
                    <div class="form-group">
                        <label for="schedulePreferences">Tell us about how you'd like to structure your time at our farm</label>
                        <textarea id="schedulePreferences" name="schedulePreferences" rows="4" placeholder="Please describe your preferred schedule, activities, meal times, and any specific timing requirements for your overnight stay..."></textarea>
                    </div>
                </div>

                <!-- Additional Information Section -->
                <div class="form-section">
                    <h3>💬 Additional Comments</h3>

                    <div class="form-group">
                        <label for="foodPreferences">Food Preferences/Dietary Requirements</label>
                        <textarea id="foodPreferences" name="foodPreferences" rows="2" placeholder="Any dietary restrictions, allergies, or special food requirements?"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="additionalComments">Additional Comments or Special Requests</label>
                        <textarea id="additionalComments" name="additionalComments" rows="4" placeholder="Any additional information, questions, or special requests you'd like to share?"></textarea>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    Submit Visit Planning Request
                </button>

                <div class="loading" id="loadingMessage">
                    <p>🔄 Submitting your request...</p>
                </div>

                <div class="success-message" id="successMessage">
                    <h4>✅ Visit Request Submitted Successfully!</h4>
                    <p>Thank you for your interest in visiting Alella Green Tech. We'll review your request and contact you within 2-3 business days to confirm details and availability.</p>
                </div>

                <div class="error-message" id="errorMessage">
                    <h4>❌ Submission Error</h4>
                    <p>There was an error submitting your request. Please try again or contact us directly at <a href="mailto:visits@alellagreentech.org">visits@alellagreentech.org</a></p>
                </div>
            </form>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Alella Green Tech. <a href="../index.html">Back to GUIDAL</a></p>
        </div>
    </footer>

    <!-- Load required scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Wait for Supabase to load before loading other scripts
        if (!window.supabase) {
            console.error('❌ Supabase library failed to load');
        } else {
            console.log('✅ Supabase library loaded successfully');
        }
    </script>
    <script src="../js/supabase-client.js"></script>
    <script>
        // Wait for supabaseClient to be available before loading visit-planning.js
        function waitForSupabaseClient() {
            if (typeof window.supabaseClient !== 'undefined') {
                console.log('✅ supabaseClient is available, loading visit-planning.js');
                const script = document.createElement('script');
                script.src = '../js/visit-planning.js';
                document.head.appendChild(script);
            } else {
                console.log('⏳ Waiting for supabaseClient...');
                setTimeout(waitForSupabaseClient, 100);
            }
        }

        // Start checking for supabaseClient
        waitForSupabaseClient();
    </script>

    <!-- Mobile Menu Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const navMenu = document.querySelector('.nav-menu');

            if (mobileMenuToggle && navMenu) {
                mobileMenuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.main-nav')) {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    }
                });

                // Close menu when clicking a nav link
                const navLinks = document.querySelectorAll('.nav-menu a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    });
                });
            }

            // Handle radio button selection styling
            const radioGroups = document.querySelectorAll('.radio-group');
            radioGroups.forEach(group => {
                const radioOptions = group.querySelectorAll('.radio-option');
                radioOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        // Remove selected class from all options in this group
                        radioOptions.forEach(opt => opt.classList.remove('selected'));
                        // Add selected class to clicked option
                        if (this.querySelector('input[type="radio"]').checked) {
                            this.classList.add('selected');
                        }
                    });
                });
            });

            // Handle "Other" option visibility
            const languageSelect = document.getElementById('language');
            const languageOther = document.getElementById('languageOther');

            if (languageSelect && languageOther) {
                languageSelect.addEventListener('change', function() {
                if (this.value === 'other') {
                    languageOther.style.display = 'block';
                    languageOther.previousElementSibling.style.opacity = '1';
                } else {
                    languageOther.style.display = 'none';
                    languageOther.previousElementSibling.style.opacity = '0';
                }
            });
            }

            // Handle "Other" radio button inputs
            const visitFormatOther = document.getElementById('visitFormatOther');
            const educationalFocusOther = document.getElementById('educationalFocusOther');
            const visitFormatRadio = document.querySelector('input[name="visitFormat"][value="other"]');
            const educationalFocusRadio = document.querySelector('input[name="educationalFocus"][value="other"]');

            if (visitFormatRadio && visitFormatOther) {
                visitFormatRadio.addEventListener('change', function() {
                    visitFormatOther.classList.toggle('visible', this.checked);
                });
            }

            if (educationalFocusRadio && educationalFocusOther) {
                educationalFocusRadio.addEventListener('change', function() {
                    educationalFocusOther.classList.toggle('visible', this.checked);
                });
            }

            // Handle visit type selection
            const visitTypeOptions = document.querySelectorAll('input[name="visitType"]');
            const overnightFields = document.getElementById('overnightFields');
            const dayTripSchedule = document.getElementById('dayTripSchedule');
            const dayTripFormatSection = document.getElementById('dayTripFormatSection');
            const overnightScheduleSection = document.getElementById('overnightScheduleSection');
            const numberOfNightsSelect = document.getElementById('numberOfNights');
            const customNightsGroup = document.getElementById('customNightsGroup');

            console.log('Found visit type options:', visitTypeOptions.length);
            console.log('Found overnight fields element:', !!overnightFields);
            console.log('Found day trip schedule element:', !!dayTripSchedule);
            console.log('Found day trip format section:', !!dayTripFormatSection);
            console.log('Found overnight schedule section:', !!overnightScheduleSection);

            visitTypeOptions.forEach(option => {
                option.addEventListener('change', function() {
                    // Update active styling
                    document.querySelectorAll('.visit-type-option').forEach(label => {
                        label.classList.remove('active');
                    });
                    this.closest('.visit-type-option').classList.add('active');

                    // Show/hide appropriate sections based on visit type
                    console.log('Visit type changed to:', this.value);
                    if (this.value === 'school_overnight') {
                        console.log('Showing overnight fields and schedule section');
                        overnightFields.style.display = 'block';
                        dayTripSchedule.style.display = 'none';
                        dayTripFormatSection.style.display = 'none';
                        overnightScheduleSection.style.display = 'block';
                    } else if (this.value === 'school_day_trip') {
                        console.log('Showing day trip schedule and format section');
                        overnightFields.style.display = 'none';
                        dayTripSchedule.style.display = 'block';
                        dayTripFormatSection.style.display = 'block';
                        overnightScheduleSection.style.display = 'none';
                    } else {
                        console.log('Hiding all conditional sections');
                        overnightFields.style.display = 'none';
                        dayTripSchedule.style.display = 'none';
                        dayTripFormatSection.style.display = 'none';
                        overnightScheduleSection.style.display = 'none';
                    }
                });
            });

            // Handle custom nights selection
            if (numberOfNightsSelect && customNightsGroup) {
                numberOfNightsSelect.addEventListener('change', function() {
                    if (this.value === 'other') {
                        customNightsGroup.style.display = 'block';
                    } else {
                        customNightsGroup.style.display = 'none';
                    }
                });
            }

            // Handle accommodation selection styling
            const accommodationOptions = document.querySelectorAll('input[name="accommodationSelection"]');
            accommodationOptions.forEach(option => {
                option.addEventListener('change', function() {
                    // Remove selected styling from all options
                    document.querySelectorAll('.accommodation-option').forEach(label => {
                        label.classList.remove('selected');
                    });
                    // Add selected styling to chosen option
                    if (this.checked) {
                        this.closest('.accommodation-option').classList.add('selected');
                    }
                });
            });

            // Handle accordion functionality
            const accordionHeaders = document.querySelectorAll('.accordion-header');
            accordionHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    const isActive = this.classList.contains('active');

                    // Toggle this accordion
                    if (isActive) {
                        this.classList.remove('active');
                        content.classList.remove('active');
                    } else {
                        this.classList.add('active');
                        content.classList.add('active');
                    }
                });
            });

            // Handle city input formatting
            const cityInput = document.getElementById('city');
            if (cityInput) {
                cityInput.addEventListener('input', function() {
                    // Auto-format: capitalize first letter of each word
                    this.value = this.value.replace(/\b\w/g, l => l.toUpperCase());
                });
            }

            // Form submission handling
            const form = document.getElementById('visitPlanningForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const submitBtn = form.querySelector('button[type="submit"]');
                    const originalBtnText = submitBtn ? submitBtn.textContent : '';

                    try {
                        if (submitBtn) {
                            submitBtn.disabled = true;
                            submitBtn.textContent = '⏳ Submitting...';
                        }

                        // Gather form data
                        const formData = new FormData(form);

                        // Build the visit data object
                        const visitData = {
                            // Visit type and basic info
                            visit_type: formData.get('visitType') || 'school_day_trip',

                            // Contact information
                            contact_email: formData.get('leadTeacherEmail'),
                            lead_teacher_contact: formData.get('leadTeacherName'),

                            // School information
                            school_name: formData.get('schoolName'),
                            country_of_origin: formData.get('country'),
                            city: formData.get('city'),

                            // Visit details
                            proposed_visit_date: formData.get('proposedVisitDate') || null,
                            potential_visit_dates: formData.get('visitDates') || null,
                            preferred_language: formData.get('language'),

                            // Participant numbers
                            number_of_students: parseInt(formData.get('studentCount')) || 0,
                            number_of_adults: parseInt(formData.get('adultCount')) || 0,

                            // Visit format and focus
                            visit_format: formData.get('visitFormat'),
                            visit_format_other: formData.get('visitFormatOther') || null,
                            educational_focus: formData.get('educationalFocus'),
                            educational_focus_other: formData.get('educationalFocusOther') || null,

                            // Food and comments
                            food_preferences: formData.get('foodPreferences') || null,
                            additional_comments: formData.get('additionalComments') || null,

                            // Overnight-specific fields
                            number_of_nights: formData.get('visitType') === 'school_overnight' ? parseInt(formData.get('numberOfNights') || formData.get('customNights') || 0) : 0,
                            arrival_date_time: formData.get('arrivalDateTime') || null,
                            departure_date_time: formData.get('departureDateTime') || null,
                            accommodation_selection: formData.get('accommodationSelection') || null,
                            accommodation_needs: formData.get('accommodationNeeds') || null,
                            schedule_preferences: formData.get('schedulePreferences') || null,

                            // Metadata
                            status: 'pending'
                        };

                        console.log('📝 Submitting visit request:', visitData);

                        // Wait for Supabase client to be ready
                        if (!window.supabaseClient) {
                            throw new Error('Database connection not ready. Please refresh the page and try again.');
                        }

                        // Submit to database
                        const { data, error } = await window.supabaseClient
                            .from('visits')
                            .insert([visitData])
                            .select();

                        if (error) {
                            console.error('❌ Error submitting visit:', error);
                            throw new Error(error.message || 'Failed to submit visit request');
                        }

                        console.log('✅ Visit request submitted successfully:', data);

                        // Show success message
                        alert('✅ Thank you! Your visit request has been submitted successfully. We will contact you soon at ' + visitData.contact_email);

                        // Reset form
                        form.reset();

                    } catch (error) {
                        console.error('❌ Form submission error:', error);
                        alert('❌ Error submitting form: ' + error.message + '\n\nPlease try again or contact us directly via WhatsApp.');
                    } finally {
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = originalBtnText;
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>