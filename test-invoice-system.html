<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Invoice System - GUIDAL</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Invoice System Test</h1>
        <div id="test-results"></div>
        <button onclick="testInvoiceGeneration()">Test Invoice Generation</button>
        <button onclick="testVisitsData()">Test Visits Data Access</button>
    </div>

    <!-- Required Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    <script>
        async function testVisitsData() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing visits data access...</p>';

            try {
                // Test if we can access visits data
                const visits = await GuidalDB.getVisits();
                console.log('‚úÖ Visits data:', visits);

                resultsDiv.innerHTML = `
                    <h3>‚úÖ Visits Data Test Results:</h3>
                    <p><strong>Total visits found:</strong> ${visits.length}</p>
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 1rem; margin: 1rem 0;">
                        <pre>${JSON.stringify(visits, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                console.error('‚ùå Error accessing visits:', error);
                resultsDiv.innerHTML = `
                    <h3>‚ùå Visits Data Test Failed:</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }

        async function testInvoiceGeneration() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing invoice generation system...</p>';

            try {
                // Test basic database connection
                const connectionTest = await GuidalDB.testConnection();
                console.log('üîç Database connection:', connectionTest ? '‚úÖ Success' : '‚ùå Failed');

                if (!connectionTest) {
                    throw new Error('Database connection failed');
                }

                // Test if visits table exists and has data
                const visits = await GuidalDB.getVisits();
                console.log('üìä Visits data:', visits);

                // Test if schools table is accessible
                const schools = await GuidalDB.getSchools();
                console.log('üè´ Schools data:', schools);

                resultsDiv.innerHTML = `
                    <h3>‚úÖ Invoice System Test Results:</h3>
                    <p><strong>Database Connection:</strong> ‚úÖ Connected</p>
                    <p><strong>Visits Table:</strong> ${visits.length} records found</p>
                    <p><strong>Schools Table:</strong> ${schools.length} records found</p>
                    <h4>Sample Data:</h4>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 1rem; margin: 1rem 0;">
                        <strong>First Visit:</strong>
                        <pre>${visits.length > 0 ? JSON.stringify(visits[0], null, 2) : 'No visits found'}</pre>
                    </div>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 1rem; margin: 1rem 0;">
                        <strong>First School:</strong>
                        <pre>${schools.length > 0 ? JSON.stringify(schools[0], null, 2) : 'No schools found'}</pre>
                    </div>
                `;
            } catch (error) {
                console.error('‚ùå Invoice generation test failed:', error);
                resultsDiv.innerHTML = `
                    <h3>‚ùå Invoice System Test Failed:</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Details:</strong> ${error.stack || 'No additional details'}</p>
                `;
            }
        }

        // Run basic test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Invoice system test page loaded');
            setTimeout(testInvoiceGeneration, 1000);
        });
    </script>
</body>
</html>