<!DOCTYPE html>
<html>
<head>
    <title>Check Existing Visit Data</title>
</head>
<body>
    <h1>Check Existing Visit Data in Database</h1>
    <div id="results">Loading...</div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-client.js"></script>
    <script>
        async function checkExistingData() {
            try {
                console.log('üîç Checking for existing visit data...');

                // Check school_visits table
                const { data: schoolVisits, error: schoolError } = await supabaseClient
                    .from('school_visits')
                    .select('*');

                // Check activities table for school visit activities
                const { data: activities, error: actError } = await supabaseClient
                    .from('activities')
                    .select('*')
                    .ilike('title', '%school%');

                // Check schools table
                const { data: schools, error: schoolsError } = await supabaseClient
                    .from('schools')
                    .select('*');

                let html = '<h2>Existing Data Found:</h2>';

                if (!schoolError && schoolVisits && schoolVisits.length > 0) {
                    html += `<h3>School Visits Table (${schoolVisits.length} records)</h3>`;
                    html += '<table border="1" style="border-collapse: collapse; width: 100%;">';
                    html += '<tr><th>School</th><th>Teacher</th><th>Students</th><th>Grade</th><th>Access Code</th></tr>';
                    schoolVisits.forEach(visit => {
                        html += `<tr>
                            <td>${visit.school_id || 'N/A'}</td>
                            <td>${visit.teacher_name || 'N/A'}</td>
                            <td>${visit.student_count || 'N/A'}</td>
                            <td>${visit.grade_level || 'N/A'}</td>
                            <td>${visit.access_code || 'N/A'}</td>
                        </tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>No school_visits table data found</p>';
                }

                if (!actError && activities && activities.length > 0) {
                    html += `<h3>School Visit Activities (${activities.length} records)</h3>`;
                    html += '<table border="1" style="border-collapse: collapse; width: 100%;">';
                    html += '<tr><th>Title</th><th>Date</th><th>Max Participants</th><th>Status</th></tr>';
                    activities.forEach(activity => {
                        html += `<tr>
                            <td>${activity.title}</td>
                            <td>${activity.date_time || 'N/A'}</td>
                            <td>${activity.max_participants || 'N/A'}</td>
                            <td>${activity.status || 'N/A'}</td>
                        </tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>No school visit activities found</p>';
                }

                if (!schoolsError && schools && schools.length > 0) {
                    html += `<h3>Schools Table (${schools.length} records)</h3>`;
                    html += '<table border="1" style="border-collapse: collapse; width: 100%;">';
                    html += '<tr><th>Name</th><th>Address</th><th>Contact</th><th>Email</th></tr>';
                    schools.forEach(school => {
                        html += `<tr>
                            <td>${school.name}</td>
                            <td>${school.address || 'N/A'}</td>
                            <td>${school.contact_person || 'N/A'}</td>
                            <td>${school.contact_email || 'N/A'}</td>
                        </tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>No schools data found</p>';
                }

                document.getElementById('results').innerHTML = html;

                // Log the data structure for migration planning
                console.log('üìä School Visits Data:', schoolVisits);
                console.log('üìä Activities Data:', activities);
                console.log('üìä Schools Data:', schools);

            } catch (err) {
                console.error('‚ùå Error:', err);
                document.getElementById('results').innerHTML = `<p style="color: red;">Error: ${err.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (typeof supabaseClient === 'undefined') {
                console.error('‚ùå Supabase client not loaded');
                return;
            }
            checkExistingData();
        });
    </script>
</body>
</html>