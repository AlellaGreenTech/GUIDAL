<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Editor - GUIDAL Admin</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        .admin-header {
            background: linear-gradient(135deg, #1565c0, #0d47a1);
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        .admin-nav {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .admin-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 2rem;
        }

        .admin-nav a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .admin-nav a:hover,
        .admin-nav a.active {
            background: #1565c0;
            color: white;
        }

        .form-editor-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .sidebar {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .sidebar h3 {
            margin: 0 0 1rem 0;
            color: #1565c0;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 0.5rem;
        }

        .field-types {
            display: grid;
            gap: 0.5rem;
        }

        .field-type-btn {
            padding: 0.75rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .field-type-btn:hover {
            background: #f8f9fa;
            border-color: #1565c0;
        }

        .field-type-btn.dragging {
            opacity: 0.5;
        }

        .main-editor {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .editor-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .editor-header h2 {
            margin: 0;
            color: #1565c0;
            flex-grow: 1;
        }

        .editor-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #1565c0;
            color: white;
        }

        .btn-primary:hover {
            background: #0d47a1;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .form-preview {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem;
            min-height: 400px;
            position: relative;
        }

        .form-preview.drag-over {
            border-color: #1565c0;
            background: #f8f9fa;
        }

        .form-preview.empty::before {
            content: "Drag form fields here to build your form";
            display: block;
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 4rem;
        }

        .form-field {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            position: relative;
            background: white;
            cursor: move;
        }

        .form-field:hover {
            border-color: #1565c0;
            box-shadow: 0 2px 4px rgba(21, 101, 192, 0.1);
        }

        .form-field.selected {
            border-color: #1565c0;
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
        }

        .field-controls {
            position: absolute;
            top: -12px;
            right: 8px;
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .form-field:hover .field-controls {
            opacity: 1;
        }

        .field-control-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .field-control-btn:hover {
            background: #f8f9fa;
        }

        .field-control-btn.edit {
            color: #1565c0;
        }

        .field-control-btn.delete {
            color: #dc3545;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1565c0;
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
        }

        .field-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .field-editor-modal.active {
            display: flex;
        }

        .field-editor-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .field-editor-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .field-editor-header h3 {
            margin: 0;
            color: #1565c0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .field-editor-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .checkbox-group,
        .radio-group {
            display: grid;
            gap: 0.5rem;
        }

        .option-input {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .option-input input {
            flex: 1;
        }

        .option-input button {
            padding: 0.25rem 0.5rem;
            border: 1px solid #dc3545;
            background: white;
            color: #dc3545;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .option-input button:hover {
            background: #dc3545;
            color: white;
        }

        .add-option-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #28a745;
            background: white;
            color: #28a745;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .add-option-btn:hover {
            background: #28a745;
            color: white;
        }

        .success-message,
        .error-message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .form-editor-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }

            .editor-header {
                flex-direction: column;
                align-items: stretch;
            }

            .editor-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <h1>📝 Trip Planning Form Editor</h1>
            <p>Customize the trip planning form structure and questions</p>
        </div>
    </div>

    <nav class="admin-nav">
        <div class="container">
            <ul>
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="visit-requests.html">Visit Requests</a></li>
                <li><a href="form-editor.html" class="active">Form Editor</a></li>
                <li><a href="invoices.html">Invoices</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="../index.html">Back to Site</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div id="messages"></div>

        <div class="form-editor-container">
            <!-- Sidebar with field types -->
            <div class="sidebar">
                <h3>📋 Field Types</h3>
                <div class="field-types">
                    <div class="field-type-btn" draggable="true" data-type="text">
                        <span>📝</span>
                        <span>Text Input</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="textarea">
                        <span>📄</span>
                        <span>Text Area</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="email">
                        <span>📧</span>
                        <span>Email</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="phone">
                        <span>📞</span>
                        <span>Phone</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="number">
                        <span>🔢</span>
                        <span>Number</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="date">
                        <span>📅</span>
                        <span>Date</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="select">
                        <span>📋</span>
                        <span>Dropdown</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="radio">
                        <span>🔘</span>
                        <span>Radio Buttons</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="checkbox">
                        <span>☑️</span>
                        <span>Checkboxes</span>
                    </div>
                    <div class="field-type-btn" draggable="true" data-type="section">
                        <span>📂</span>
                        <span>Section Header</span>
                    </div>
                </div>
            </div>

            <!-- Main editor area -->
            <div class="main-editor">
                <div class="editor-header">
                    <h2>Form Structure</h2>
                    <div class="editor-actions">
                        <button class="btn btn-secondary" id="previewBtn">👁️ Preview</button>
                        <button class="btn btn-primary" id="saveBtn">💾 Save Form</button>
                        <button class="btn btn-success" id="publishBtn">🚀 Publish</button>
                    </div>
                </div>

                <div class="form-preview empty" id="formPreview">
                    <!-- Form fields will be dynamically added here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Field Editor Modal -->
    <div class="field-editor-modal" id="fieldEditorModal">
        <div class="field-editor-content">
            <div class="field-editor-header">
                <h3 id="fieldEditorTitle">Edit Field</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>

            <form id="fieldEditorForm">
                <div class="form-group">
                    <label for="fieldLabel">Field Label:</label>
                    <input type="text" id="fieldLabel" name="label" required>
                </div>

                <div class="form-group">
                    <label for="fieldName">Field Name (ID):</label>
                    <input type="text" id="fieldName" name="name" required>
                </div>

                <div class="form-group">
                    <label for="fieldPlaceholder">Placeholder Text:</label>
                    <input type="text" id="fieldPlaceholder" name="placeholder">
                </div>

                <div class="form-group">
                    <label for="fieldHelp">Help Text:</label>
                    <textarea id="fieldHelp" name="help" rows="2"></textarea>
                </div>

                <div class="form-group" id="fieldOptionsGroup" style="display: none;">
                    <label>Options:</label>
                    <div id="fieldOptions" class="checkbox-group">
                        <!-- Options will be added dynamically -->
                    </div>
                    <button type="button" class="add-option-btn" id="addOptionBtn">+ Add Option</button>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="fieldRequired" name="required">
                        Required Field
                    </label>
                </div>

                <div class="field-editor-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Field</button>
                </div>
            </form>
        </div>
    </div>

    <footer style="margin-top: 3rem; padding: 2rem 0; background: #f8f9fa; text-align: center;">
        <div class="container">
            <p>&copy; 2024 GUIDAL Form Editor - Alella Green Tech</p>
        </div>
    </footer>

    <!-- Load required scripts -->
    <script src="../js/supabase-client.js"></script>
    <script src="js/auth-guard.js"></script>
    <script>
        // Form Editor JavaScript
        class FormEditor {
            constructor() {
                this.fields = [];
                this.currentEditIndex = null;
                this.init();
            }

            init() {
                console.log('🛠️ Initializing Form Editor...');

                this.setupDragAndDrop();
                this.setupEventListeners();
                this.loadFormStructure();

                console.log('✅ Form Editor initialized');
            }

            setupDragAndDrop() {
                const fieldTypes = document.querySelectorAll('.field-type-btn');
                const formPreview = document.getElementById('formPreview');

                fieldTypes.forEach(btn => {
                    btn.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', btn.dataset.type);
                        btn.classList.add('dragging');
                    });

                    btn.addEventListener('dragend', () => {
                        btn.classList.remove('dragging');
                    });
                });

                formPreview.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    formPreview.classList.add('drag-over');
                });

                formPreview.addEventListener('dragleave', () => {
                    formPreview.classList.remove('drag-over');
                });

                formPreview.addEventListener('drop', (e) => {
                    e.preventDefault();
                    formPreview.classList.remove('drag-over');

                    const fieldType = e.dataTransfer.getData('text/plain');
                    this.addField(fieldType);
                });
            }

            setupEventListeners() {
                // Save button
                document.getElementById('saveBtn').addEventListener('click', () => {
                    this.saveForm();
                });

                // Publish button
                document.getElementById('publishBtn').addEventListener('click', () => {
                    this.publishForm();
                });

                // Preview button
                document.getElementById('previewBtn').addEventListener('click', () => {
                    this.previewForm();
                });

                // Modal controls
                document.getElementById('modalClose').addEventListener('click', () => {
                    this.closeFieldEditor();
                });

                document.getElementById('cancelEdit').addEventListener('click', () => {
                    this.closeFieldEditor();
                });

                document.getElementById('fieldEditorForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveField();
                });

                document.getElementById('addOptionBtn').addEventListener('click', () => {
                    this.addOption();
                });

                // Field name auto-generation
                document.getElementById('fieldLabel').addEventListener('input', (e) => {
                    const nameField = document.getElementById('fieldName');
                    if (!nameField.value) {
                        nameField.value = this.generateFieldName(e.target.value);
                    }
                });
            }

            addField(type) {
                const field = {
                    type: type,
                    label: this.getDefaultLabel(type),
                    name: this.generateFieldName(this.getDefaultLabel(type)),
                    placeholder: '',
                    help: '',
                    required: false,
                    options: type === 'select' || type === 'radio' || type === 'checkbox' ? ['Option 1', 'Option 2'] : []
                };

                this.fields.push(field);
                this.renderForm();
                this.editField(this.fields.length - 1);
            }

            getDefaultLabel(type) {
                const labels = {
                    text: 'Text Input',
                    textarea: 'Text Area',
                    email: 'Email Address',
                    phone: 'Phone Number',
                    number: 'Number',
                    date: 'Date',
                    select: 'Dropdown Selection',
                    radio: 'Radio Selection',
                    checkbox: 'Checkbox Options',
                    section: 'Section Title'
                };
                return labels[type] || 'Field';
            }

            generateFieldName(label) {
                return label.toLowerCase()
                    .replace(/[^a-z0-9\s]/g, '')
                    .replace(/\s+/g, '_');
            }

            renderForm() {
                const formPreview = document.getElementById('formPreview');

                if (this.fields.length === 0) {
                    formPreview.classList.add('empty');
                    formPreview.innerHTML = '';
                    return;
                }

                formPreview.classList.remove('empty');

                const html = this.fields.map((field, index) => {
                    return `
                        <div class="form-field" data-index="${index}">
                            <div class="field-controls">
                                <button class="field-control-btn edit" onclick="formEditor.editField(${index})" title="Edit">✏️</button>
                                <button class="field-control-btn delete" onclick="formEditor.deleteField(${index})" title="Delete">🗑️</button>
                            </div>
                            ${this.renderFieldPreview(field)}
                        </div>
                    `;
                }).join('');

                formPreview.innerHTML = html;
            }

            renderFieldPreview(field) {
                switch (field.type) {
                    case 'section':
                        return `
                            <h3 style="margin: 0 0 0.5rem 0; color: #1565c0; border-bottom: 2px solid #e3f2fd; padding-bottom: 0.5rem;">
                                ${field.label}
                            </h3>
                            ${field.help ? `<p style="margin: 0; color: #666; font-size: 0.9rem;">${field.help}</p>` : ''}
                        `;

                    case 'textarea':
                        return `
                            <div class="form-group">
                                <label>${field.label}${field.required ? ' *' : ''}</label>
                                <textarea placeholder="${field.placeholder}" rows="3" disabled></textarea>
                                ${field.help ? `<small style="color: #666;">${field.help}</small>` : ''}
                            </div>
                        `;

                    case 'select':
                        return `
                            <div class="form-group">
                                <label>${field.label}${field.required ? ' *' : ''}</label>
                                <select disabled>
                                    <option>${field.placeholder || 'Select an option'}</option>
                                    ${field.options.map(opt => `<option>${opt}</option>`).join('')}
                                </select>
                                ${field.help ? `<small style="color: #666;">${field.help}</small>` : ''}
                            </div>
                        `;

                    case 'radio':
                        return `
                            <div class="form-group">
                                <label>${field.label}${field.required ? ' *' : ''}</label>
                                <div class="radio-group">
                                    ${field.options.map((opt, i) => `
                                        <label style="font-weight: normal; display: flex; align-items: center; gap: 0.5rem;">
                                            <input type="radio" name="preview_${field.name}" disabled>
                                            <span>${opt}</span>
                                        </label>
                                    `).join('')}
                                </div>
                                ${field.help ? `<small style="color: #666;">${field.help}</small>` : ''}
                            </div>
                        `;

                    case 'checkbox':
                        return `
                            <div class="form-group">
                                <label>${field.label}${field.required ? ' *' : ''}</label>
                                <div class="checkbox-group">
                                    ${field.options.map(opt => `
                                        <label style="font-weight: normal; display: flex; align-items: center; gap: 0.5rem;">
                                            <input type="checkbox" disabled>
                                            <span>${opt}</span>
                                        </label>
                                    `).join('')}
                                </div>
                                ${field.help ? `<small style="color: #666;">${field.help}</small>` : ''}
                            </div>
                        `;

                    default:
                        return `
                            <div class="form-group">
                                <label>${field.label}${field.required ? ' *' : ''}</label>
                                <input type="${field.type}" placeholder="${field.placeholder}" disabled>
                                ${field.help ? `<small style="color: #666;">${field.help}</small>` : ''}
                            </div>
                        `;
                }
            }

            editField(index) {
                this.currentEditIndex = index;
                const field = this.fields[index];

                // Populate form
                document.getElementById('fieldLabel').value = field.label;
                document.getElementById('fieldName').value = field.name;
                document.getElementById('fieldPlaceholder').value = field.placeholder;
                document.getElementById('fieldHelp').value = field.help;
                document.getElementById('fieldRequired').checked = field.required;

                // Handle options for select/radio/checkbox
                const optionsGroup = document.getElementById('fieldOptionsGroup');
                if (['select', 'radio', 'checkbox'].includes(field.type)) {
                    optionsGroup.style.display = 'block';
                    this.renderOptions(field.options);
                } else {
                    optionsGroup.style.display = 'none';
                }

                document.getElementById('fieldEditorTitle').textContent = `Edit ${this.getDefaultLabel(field.type)}`;
                document.getElementById('fieldEditorModal').classList.add('active');
            }

            renderOptions(options = []) {
                const container = document.getElementById('fieldOptions');
                container.innerHTML = options.map((option, index) => `
                    <div class="option-input">
                        <input type="text" value="${option}" onchange="formEditor.updateOption(${index}, this.value)">
                        <button type="button" onclick="formEditor.removeOption(${index})">Remove</button>
                    </div>
                `).join('');
            }

            addOption() {
                const field = this.fields[this.currentEditIndex];
                field.options.push('New Option');
                this.renderOptions(field.options);
            }

            updateOption(index, value) {
                const field = this.fields[this.currentEditIndex];
                field.options[index] = value;
            }

            removeOption(index) {
                const field = this.fields[this.currentEditIndex];
                field.options.splice(index, 1);
                this.renderOptions(field.options);
            }

            saveField() {
                const form = document.getElementById('fieldEditorForm');
                const formData = new FormData(form);

                const field = this.fields[this.currentEditIndex];
                field.label = formData.get('label');
                field.name = formData.get('name');
                field.placeholder = formData.get('placeholder');
                field.help = formData.get('help');
                field.required = formData.get('required') === 'on';

                this.renderForm();
                this.closeFieldEditor();
            }

            deleteField(index) {
                if (confirm('Are you sure you want to delete this field?')) {
                    this.fields.splice(index, 1);
                    this.renderForm();
                }
            }

            closeFieldEditor() {
                document.getElementById('fieldEditorModal').classList.remove('active');
                this.currentEditIndex = null;
            }

            async saveForm() {
                try {
                    console.log('💾 Saving form structure...');

                    // Save to localStorage for now (could be enhanced with database storage)
                    localStorage.setItem('tripPlanningFormStructure', JSON.stringify(this.fields));

                    this.showMessage('Form structure saved successfully!', 'success');

                } catch (error) {
                    console.error('Error saving form:', error);
                    this.showMessage('Error saving form structure', 'error');
                }
            }

            async publishForm() {
                try {
                    console.log('🚀 Publishing form...');

                    await this.saveForm();

                    // Here you would update the actual visit-planning.html file
                    // For now, we'll just show a success message
                    this.showMessage('Form published successfully! Changes will be visible on the visit planning page.', 'success');

                } catch (error) {
                    console.error('Error publishing form:', error);
                    this.showMessage('Error publishing form', 'error');
                }
            }

            previewForm() {
                // Open trip planning page in new tab for preview
                window.open('../pages/visit-planning.html', '_blank');
            }

            async loadFormStructure() {
                try {
                    // Load saved form structure from localStorage
                    const saved = localStorage.getItem('tripPlanningFormStructure');
                    if (saved) {
                        this.fields = JSON.parse(saved);
                        this.renderForm();
                        console.log('📋 Loaded saved form structure');
                    } else {
                        // Load default structure from existing form
                        this.loadDefaultStructure();
                    }
                } catch (error) {
                    console.error('Error loading form structure:', error);
                    this.loadDefaultStructure();
                }
            }

            loadDefaultStructure() {
                // Default form structure based on current visit-planning.html
                this.fields = [
                    {
                        type: 'section',
                        label: 'School Information',
                        name: 'school_info',
                        help: 'Please provide details about your school'
                    },
                    {
                        type: 'text',
                        label: 'School Name',
                        name: 'school_name',
                        placeholder: 'Enter your school name',
                        required: true
                    },
                    {
                        type: 'text',
                        label: 'Contact Name',
                        name: 'contact_name',
                        placeholder: 'Your name',
                        required: true
                    },
                    {
                        type: 'email',
                        label: 'Contact Email',
                        name: 'contact_email',
                        placeholder: 'your.email@school.edu',
                        required: true
                    },
                    {
                        type: 'section',
                        label: 'Group Details',
                        name: 'group_details',
                        help: 'Tell us about your group'
                    },
                    {
                        type: 'number',
                        label: 'Number of Students',
                        name: 'student_count',
                        placeholder: 'e.g., 25',
                        required: true
                    },
                    {
                        type: 'select',
                        label: 'Grade Level',
                        name: 'grade_level',
                        required: true,
                        options: ['Elementary (K-5)', 'Middle School (6-8)', 'High School (9-12)', 'University/College']
                    }
                ];

                this.renderForm();
                console.log('📋 Loaded default form structure');
            }

            showMessage(text, type = 'success') {
                const messagesContainer = document.getElementById('messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `${type}-message`;
                messageDiv.textContent = text;

                messagesContainer.appendChild(messageDiv);

                setTimeout(() => {
                    messageDiv.remove();
                }, 5000);
            }
        }

        // Initialize form editor when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof supabaseClient === 'undefined') {
                console.error('❌ Supabase client not loaded');
                return;
            }

            window.formEditor = new FormEditor();
        });
    </script>
</body>
</html>