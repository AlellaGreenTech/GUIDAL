<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station 1: Planting - GUIDAL</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Centered vertical header layout */
        .station-header {
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 2rem;
        }

        .station-title {
            margin-bottom: 1.5rem;
        }

        .station-title h2 {
            margin: 0;
            font-size: 1.8rem;
        }

        .station-subtitle {
            margin: 0.5rem 0 0 0;
            color: #666;
            font-size: 1rem;
        }

        .station-meta {
            display: flex;
            justify-content: center;
            gap: 3rem;
            align-items: center;
        }

        .meta-item {
            color: #666;
            font-size: 0.9rem;
        }

        .meta-item strong {
            color: #2e7d32;
            font-size: 1.1rem;
        }

        /* Accordion Styles */
        .accordion-section {
            margin: 1rem 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .accordion-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .accordion-header:hover {
            background: #f0f0f0;
        }

        .accordion-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .accordion-arrow {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .accordion-content {
            display: none;
            padding: 1.5rem;
            background: white;
        }

        .accordion-content.open {
            display: block;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .station-meta {
                flex-wrap: wrap;
                gap: 1.5rem;
                justify-content: center;
            }

            .station-title h2 {
                font-size: 1.5rem;
            }

            .station-subtitle {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <p class="foundation-presents">The International Green Tech Foundation Presents</p>
            <h1><a href="../index.html">GUIDAL</a></h1>
            <p class="subtitle">Station 1: Planting at <a href="https://alellagreentech.org" target="_blank" class="agt-link">Alella Green Tech</a></p>
        </div>
    </header>
    
    <nav class="main-nav">
        <div class="container">
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <ul class="nav-menu">
                <li><a href="../visits/benjamin-franklin-sept-2025.html">‚Üê Back to Visit</a></li>
                <li><a href="#overview">Station Overview</a></li>
                <li><a href="#activities">Activities</a></li>
                <li><a href="#soil-tracking">Soil Tracking</a></li>
                <li><a href="#learning">Learning Goals</a></li>
                <li><a href="#resources">Resources</a></li>
            </ul>
        </div>
    </nav>
    
    <main class="container">
        <section id="station-header" class="station-header">
            <div class="station-title">
                <h2>üå± Station 1: Planting</h2>
                <p class="station-subtitle">Sustainable Agriculture & Soil Science</p>
            </div>
            <div class="station-meta">
                <span class="meta-item"><strong>40</strong> Minutes</span>
                <span class="meta-item"><strong>12</strong> Students Max</span>
                <span class="meta-item"><strong>5</strong> Green$</span>
            </div>
        </section>

        <section id="overview" class="station-overview">
            <div class="accordion-section">
                <div class="accordion-header" onclick="toggleAccordion('overview')">
                    <h2>What You'll Discover</h2>
                    <span class="accordion-arrow">‚ñº</span>
                </div>
                <div class="accordion-content" id="overview-content">
                    <div class="overview-grid">
                        <div class="overview-card">
                            <h3>üå± Seed Science</h3>
                            <p>Understanding germination, plant lifecycles, and optimal growing conditions for different species.</p>
                        </div>
                        <div class="overview-card">
                            <h3>üåç Soil Composition</h3>
                            <p>Hands-on analysis of soil types, pH levels, moisture content, and nutrient balance for healthy plant growth.</p>
                        </div>
                        <div class="overview-card">
                            <h3>üî¨ Scientific Method</h3>
                            <p>Create hypotheses, conduct experiments, and record observations about plant growth variables.</p>
                        </div>
                        <div class="overview-card">
                            <h3>‚ôªÔ∏è Sustainability</h3>
                            <p>Learn about composting, natural fertilizers, and environmentally-friendly farming practices.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="activities" class="activities-section">
            <h2>Station Steps</h2>
            <div class="activity-timeline">
                <div class="activity-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Soil Mixture Planning</h3>
                        <p>Decide amongst yourselves the formula for the perfect soil using only the ingredients in the table.<br>Submit one entry for your group.</p>
                        <div class="activity-tools">
                            <span class="tool">üèóÔ∏è Structure (sand)</span>
                            <span class="tool">üíß Water Retention (clay)</span>
                            <span class="tool">üåø Organic Matter (biomass)</span>
                            <span class="tool">ü¶† Soil Food Web (living organisms)</span>
                        </div>
                    </div>
                </div>
                
                <div class="activity-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Seed Selection & Planting (15 minutes)</h3>
                        <p>Choose from various seed types (herbs, vegetables, flowers) based on your soil mixture. Plant seeds at proper depths and spacing while learning about each plant's specific needs.</p>
                        <div class="activity-tools">
                            <span class="tool">üå± Variety of seeds</span>
                            <span class="tool">ü™¥ Planting pots</span>
                            <span class="tool">üíß Watering system</span>
                        </div>
                    </div>
                </div>
                
                <div class="activity-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Growth Prediction & Labeling (10 minutes)</h3>
                        <p>Based on your soil mixture and seed choices, predict growth rates and final plant characteristics. Create detailed labels and set up monitoring systems.</p>
                        <div class="activity-tools">
                            <span class="tool">üìù Recording sheets</span>
                            <span class="tool">üè∑Ô∏è Plant labels</span>
                            <span class="tool">üìä Prediction charts</span>
                        </div>
                    </div>
                </div>
                
                <div class="activity-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Data Recording & Analysis (5 minutes)</h3>
                        <p>Document your soil composition, planting choices, and predictions in our digital tracking system. Compare your group's approach with others and discuss potential outcomes.</p>
                        <div class="activity-tools">
                            <span class="tool">üíª Digital tracking</span>
                            <span class="tool">üìà Data comparison</span>
                            <span class="tool">ü§ù Group discussion</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="soil-tracking" class="soil-tracking-section">
            <div class="soil-tracking-container">
                <h2>üå± Station 1: Soil Mixture & Observations</h2>
                
                <!-- Global Seeds Information -->
                <div class="seeds-info">
                    <h3>üå± Seeds Being Planted Today</h3>
                    <p class="seeds-planted"><strong>All groups are planting:</strong> Basil, Cilantro, Parsley, and Lettuce</p>
                </div>

                <!-- Soil Mixture Input Form -->
                <div class="soil-input-section">
                    <h3>Record Your Group's Soil Mixture</h3>
                    <form id="stationSoilForm" class="soil-mixture-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="stationGroupNumber">Group Number:</label>
                                <select id="stationGroupNumber" name="groupNumber" required>
                                    <option value="">Select your group</option>
                                    <option value="1">Group 1</option>
                                    <option value="2">Group 2</option>
                                    <option value="3">Group 3</option>
                                    <option value="4">Group 4</option>
                                    <option value="5">Group 5</option>
                                    <option value="6">Group 6</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cowManure">Cow Manure %:</label>
                                <select id="cowManure" name="cowManure" required>
                                    <option value="">Select %</option>
                                    <option value="10">10%</option>
                                    <option value="20">20%</option>
                                    <option value="30">30%</option>
                                    <option value="40">40%</option>
                                    <option value="50">50%</option>
                                    <option value="60">60%</option>
                                    <option value="70">70%</option>
                                    <option value="80">80%</option>
                                    <option value="90">90%</option>
                                    <option value="100">100%</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="horseManure">Horse Manure & Hay %:</label>
                                <select id="horseManure" name="horseManure" required>
                                    <option value="">Select %</option>
                                    <option value="10">10%</option>
                                    <option value="20">20%</option>
                                    <option value="30">30%</option>
                                    <option value="40">40%</option>
                                    <option value="50">50%</option>
                                    <option value="60">60%</option>
                                    <option value="70">70%</option>
                                    <option value="80">80%</option>
                                    <option value="90">90%</option>
                                    <option value="100">100%</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="saulo">Saul√≥ %:</label>
                                <select id="saulo" name="saulo" required>
                                    <option value="">Select %</option>
                                    <option value="10">10%</option>
                                    <option value="20">20%</option>
                                    <option value="30">30%</option>
                                    <option value="40">40%</option>
                                    <option value="50">50%</option>
                                    <option value="60">60%</option>
                                    <option value="70">70%</option>
                                    <option value="80">80%</option>
                                    <option value="90">90%</option>
                                    <option value="100">100%</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recebo">Recebo %:</label>
                                <select id="recebo" name="recebo" required>
                                    <option value="">Select %</option>
                                    <option value="10">10%</option>
                                    <option value="20">20%</option>
                                    <option value="30">30%</option>
                                    <option value="40">40%</option>
                                    <option value="50">50%</option>
                                    <option value="60">60%</option>
                                    <option value="70">70%</option>
                                    <option value="80">80%</option>
                                    <option value="90">90%</option>
                                    <option value="100">100%</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="stationMoistureLevel">Moisture Level:</label>
                                <select id="stationMoistureLevel" name="moistureLevel" required>
                                    <option value="">Select moisture</option>
                                    <option value="dry">Dry</option>
                                    <option value="moist">Moist</option>
                                    <option value="wet">Wet</option>
                                    <option value="saturated">Saturated</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="total-display">
                                    <label>Total Percentage:</label>
                                    <div id="totalDisplay" class="total-percentage">0%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="stationPercentageWarning" class="percentage-warning" style="display: none;">
                            <p>‚ö†Ô∏è Total must equal 100%. Current total: <span id="stationTotalPercentage">0</span>%</p>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn soil-submit">üå± Record Soil Mixture</button>
                        </div>
                    </form>
                </div>

                <!-- Observations Input Form -->
                <div class="observations-input-section">
                    <h3>Add Your Observations</h3>
                    <form id="observationsForm" class="observations-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="obsGroupNumber">Group Number:</label>
                                <select id="obsGroupNumber" name="groupNumber" required>
                                    <option value="">Select your group</option>
                                    <option value="1">Group 1</option>
                                    <option value="2">Group 2</option>
                                    <option value="3">Group 3</option>
                                    <option value="4">Group 4</option>
                                    <option value="5">Group 5</option>
                                    <option value="6">Group 6</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="studentName">Your Name (optional):</label>
                                <input type="text" id="studentName" name="studentName" placeholder="Enter your name">
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="observation">Observation:</label>
                            <textarea id="observation" name="observation" rows="3" placeholder="What did you observe? Color, texture, smell, predictions..." required></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn obs-submit">üìù Add Observation</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Live Data Tables -->
            <div class="live-data-section">
                <h2>üìä Live Station Data - All Groups</h2>
                
                <!-- Soil Mixtures Table -->
                <div class="data-table-container">
                    <h3>Soil Mixture Compositions</h3>
                    <table class="data-table" id="soilMixturesTable">
                        <thead>
                            <tr>
                                <th>Group</th>
                                <th>Cow Manure %</th>
                                <th>Horse Manure & Hay %</th>
                                <th>Saul√≥ %</th>
                                <th>Recebo %</th>
                                <th>Total %</th>
                                <th>Moisture Level</th>
                            </tr>
                        </thead>
                        <tbody id="soilMixturesTableBody">
                            <tr class="empty-row">
                                <td colspan="7">No soil mixture data yet. Be the first to record your group's mixture!</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Observations Table -->
                <div class="data-table-container">
                    <h3>Group Observations</h3>
                    <table class="data-table" id="observationsTable">
                        <thead>
                            <tr>
                                <th>Group</th>
                                <th>Observation</th>
                                <th>Student Name</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="observationsTableBody">
                            <tr class="empty-row">
                                <td colspan="4">No observations yet. Share your first observation!</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="learning" class="learning-goals">
            <h2>Learning Objectives</h2>
            <div class="learning-grid">
                <div class="learning-card">
                    <h3>üéØ Primary Goals</h3>
                    <ul>
                        <li>Understand soil composition and its impact on plant growth</li>
                        <li>Apply scientific method through hypothesis and observation</li>
                        <li>Practice sustainable agriculture techniques</li>
                        <li>Develop collaborative problem-solving skills</li>
                    </ul>
                </div>
                <div class="learning-card">
                    <h3>üß™ STEM Connections</h3>
                    <ul>
                        <li><strong>Science:</strong> Botany, chemistry, biology, ecology</li>
                        <li><strong>Technology:</strong> Digital tracking, pH meters, data analysis</li>
                        <li><strong>Engineering:</strong> Irrigation systems, growing environments</li>
                        <li><strong>Math:</strong> Ratios, percentages, measurement, data analysis</li>
                    </ul>
                </div>
                <div class="learning-card">
                    <h3>üåç Real-World Applications</h3>
                    <ul>
                        <li>Urban farming and vertical agriculture</li>
                        <li>Soil restoration and environmental conservation</li>
                        <li>Food security and sustainable nutrition</li>
                        <li>Climate change adaptation strategies</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="resources" class="resources-section">
            <h2>Take It Further</h2>
            <div class="resource-grid">
                <div class="resource-card">
                    <h3>üìñ Continue Learning</h3>
                    <p>Explore advanced topics in sustainable agriculture and plant science.</p>
                    <ul>
                        <li><a href="https://www.fao.org/sustainable-development-goals/indicators/241/en/" target="_blank">FAO Sustainable Agriculture</a></li>
                        <li><a href="https://www.permaculture.org.uk/" target="_blank">Permaculture Principles</a></li>
                        <li><a href="https://www.sciencefriday.com/educational-resources/plant-science/" target="_blank">Plant Science Resources</a></li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h3>üè† At-Home Projects</h3>
                    <p>Continue your planting experiments at home or school.</p>
                    <ul>
                        <li>Start a windowsill herb garden</li>
                        <li>Create a compost system</li>
                        <li>Test different soil mixtures</li>
                        <li>Document plant growth with photos</li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h3>üí° Extension Activities</h3>
                    <p>Advanced projects for curious minds.</p>
                    <ul>
                        <li>Design a school garden layout</li>
                        <li>Research native plant species</li>
                        <li>Investigate hydroponic growing</li>
                        <li>Create a plant growth time-lapse</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            <p>&copy; 2024 Alella Green Tech. <a href="../visits/benjamin-franklin-sept-2025.html">Back to Your Visit</a></p>
            <p><strong>Station Coordinator:</strong> Dr. Elena Rodriguez | <strong>Questions:</strong> <a href="mailto:stations@allellagreentech.com">stations@allellagreentech.com</a></p>
        </div>
    </footer>
    
    <!-- Supabase JavaScript Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- GUIDAL Database Client -->
    <script src="../js/supabase-client.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu functionality
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            if (mobileMenuToggle && navMenu) {
                mobileMenuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');
                });
                
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.main-nav')) {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    }
                });
                
                const navLinks = document.querySelectorAll('.nav-menu a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    });
                });
            }

            // Station 1 soil mixture and observations tracking
            const stationSoilForm = document.getElementById('stationSoilForm');
            const observationsForm = document.getElementById('observationsForm');
            const soilMixturesTableBody = document.getElementById('soilMixturesTableBody');
            const observationsTableBody = document.getElementById('observationsTableBody');
            const totalDisplay = document.getElementById('totalDisplay');
            const stationPercentageWarning = document.getElementById('stationPercentageWarning');
            const stationTotalPercentageSpan = document.getElementById('stationTotalPercentage');
            const visitAccessCode = 'bfis-sept-2025'; // BFIS visit access code

            // Load existing data on page load
            loadSoilMixturesTable();
            loadObservationsTable();

            // Percentage validation for soil mixture form
            const percentageInputs = ['cowManure', 'horseManure', 'saulo', 'recebo'];
            percentageInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('change', validatePercentages);
                }
            });

            function validatePercentages() {
                const cowManure = parseInt(document.getElementById('cowManure').value) || 0;
                const horseManure = parseInt(document.getElementById('horseManure').value) || 0;
                const saulo = parseInt(document.getElementById('saulo').value) || 0;
                const recebo = parseInt(document.getElementById('recebo').value) || 0;
                const total = cowManure + horseManure + saulo + recebo;
                
                totalDisplay.textContent = total + '%';
                stationTotalPercentageSpan.textContent = total;
                
                if (total === 100) {
                    totalDisplay.style.backgroundColor = '#d4edda';
                    totalDisplay.style.color = '#155724';
                    stationPercentageWarning.style.display = 'none';
                } else if (total > 0) {
                    totalDisplay.style.backgroundColor = '#f8d7da';
                    totalDisplay.style.color = '#721c24';
                    stationPercentageWarning.style.display = 'block';
                } else {
                    totalDisplay.style.backgroundColor = '#e8f5e8';
                    totalDisplay.style.color = '#2d7d32';
                    stationPercentageWarning.style.display = 'none';
                }
            }

            // Soil mixture form submission
            if (stationSoilForm) {
                stationSoilForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(stationSoilForm);
                    const groupNumber = parseInt(formData.get('groupNumber'));
                    const cowManure = parseInt(formData.get('cowManure'));
                    const horseManure = parseInt(formData.get('horseManure'));
                    const saulo = parseInt(formData.get('saulo'));
                    const recebo = parseInt(formData.get('recebo'));
                    const moistureLevel = formData.get('moistureLevel');

                    // Validate percentages
                    const total = cowManure + horseManure + saulo + recebo;
                    if (total !== 100) {
                        alert(`Total must equal 100%. Current total: ${total}%`);
                        return;
                    }

                    try {
                        // Get visit ID by access code
                        const visit = await GuidalDB.getVisitByAccessCode(visitAccessCode);
                        if (!visit) {
                            alert('Visit not found. Please contact support.');
                            return;
                        }

                        // Prepare soil mixture data for new structure
                        const soilData = {
                            visit_id: visit.id,
                            group_number: groupNumber,
                            group_name: `Group ${groupNumber}`,
                            soil_type: 'mixed', // Since we have specific components now
                            compost_percentage: cowManure, // Using compost field for cow manure
                            sand_percentage: horseManure, // Using sand field for horse manure
                            clay_percentage: saulo, // Using clay field for saulo
                            ph_level: recebo, // Using ph_level field for recebo (temporary storage)
                            moisture_level: moistureLevel,
                            notes: `Cow Manure: ${cowManure}%, Horse Manure & Hay: ${horseManure}%, Saul√≥: ${saulo}%, Recebo: ${recebo}%`
                        };

                        // Check if group already has data (for updates)
                        const existingMixtures = await GuidalDB.getSoilMixtures();
                        const existingMixture = existingMixtures.find(m => m.group_number === groupNumber && m.visit_id === visit.id);

                        if (existingMixture) {
                            // Update existing mixture
                            await GuidalDB.updateSoilMixture(groupNumber, soilData);
                            alert('Soil mixture updated successfully! üå±');
                        } else {
                            // Add new mixture
                            await GuidalDB.addSoilMixture(soilData);
                            alert('Soil mixture recorded successfully! üå±');
                        }

                        // Refresh the table display
                        await loadSoilMixturesTable();
                        
                        // Reset form
                        stationSoilForm.reset();
                        validatePercentages(); // Reset total display

                    } catch (error) {
                        console.error('Error saving soil mixture:', error);
                        alert('Error saving soil mixture. Please try again.');
                    }
                });
            }

            // Observations form submission
            if (observationsForm) {
                observationsForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(observationsForm);
                    const groupNumber = parseInt(formData.get('groupNumber'));
                    const studentName = formData.get('studentName') || 'Anonymous';
                    const observation = formData.get('observation');

                    try {
                        // Get visit ID by access code
                        const visit = await GuidalDB.getVisitByAccessCode(visitAccessCode);
                        if (!visit) {
                            alert('Visit not found. Please contact support.');
                            return;
                        }

                        // Create guest book entry for observations
                        const observationData = {
                            visit_id: visit.id,
                            student_name: `Group ${groupNumber} - ${studentName}`,
                            message: observation
                        };

                        await GuidalDB.addGuestBookEntry(observationData);
                        alert('Observation added successfully! üìù');

                        // Refresh the observations table
                        await loadObservationsTable();
                        
                        // Reset form
                        observationsForm.reset();

                    } catch (error) {
                        console.error('Error saving observation:', error);
                        alert('Error saving observation. Please try again.');
                    }
                });
            }

            async function loadSoilMixturesTable() {
                try {
                    const mixtures = await GuidalDB.getSoilMixtures();
                    
                    if (mixtures.length === 0) {
                        soilMixturesTableBody.innerHTML = '<tr class="empty-row"><td colspan="7">No soil mixture data yet. Be the first to record your group\'s mixture!</td></tr>';
                        return;
                    }

                    // Sort by group number
                    mixtures.sort((a, b) => a.group_number - b.group_number);

                    soilMixturesTableBody.innerHTML = mixtures.map(mixture => {
                        const cowManure = mixture.compost_percentage || 0;
                        const horseManure = mixture.sand_percentage || 0;
                        const saulo = mixture.clay_percentage || 0;
                        const recebo = mixture.ph_level || 0;
                        const total = cowManure + horseManure + saulo + recebo;
                        const totalClass = total === 100 ? 'total-ok' : 'total-error';
                        
                        return `
                            <tr>
                                <td><strong>Group ${mixture.group_number}</strong></td>
                                <td>${cowManure}%</td>
                                <td>${horseManure}%</td>
                                <td>${saulo}%</td>
                                <td>${recebo}%</td>
                                <td class="${totalClass}">${total}%</td>
                                <td>${mixture.moisture_level || 'Not recorded'}</td>
                            </tr>
                        `;
                    }).join('');

                } catch (error) {
                    console.error('Error loading soil mixtures table:', error);
                    soilMixturesTableBody.innerHTML = '<tr class="empty-row"><td colspan="7">Error loading data. Please refresh the page.</td></tr>';
                }
            }

            async function loadObservationsTable() {
                try {
                    // Get visit by access code
                    const visit = await GuidalDB.getVisitByAccessCode(visitAccessCode);
                    if (!visit) return;
                    
                    // Get observations from guest book entries
                    const observations = await GuidalDB.getGuestBookEntries(visit.id);
                    
                    // Filter for group observations (entries that start with "Group")
                    const groupObservations = observations.filter(obs => 
                        obs.student_name.startsWith('Group')
                    );
                    
                    if (groupObservations.length === 0) {
                        observationsTableBody.innerHTML = '<tr class="empty-row"><td colspan="4">No observations yet. Share your first observation!</td></tr>';
                        return;
                    }

                    // Sort by most recent
                    groupObservations.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

                    observationsTableBody.innerHTML = groupObservations.map(obs => {
                        const nameParts = obs.student_name.split(' - ');
                        const groupName = nameParts[0] || 'Unknown Group';
                        const studentName = nameParts[1] || 'Anonymous';
                        const time = new Date(obs.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        return `
                            <tr>
                                <td><strong>${groupName}</strong></td>
                                <td>${obs.message}</td>
                                <td>${studentName}</td>
                                <td>${time}</td>
                            </tr>
                        `;
                    }).join('');

                } catch (error) {
                    console.error('Error loading observations table:', error);
                    observationsTableBody.innerHTML = '<tr class="empty-row"><td colspan="4">Error loading observations. Please refresh the page.</td></tr>';
                }
            }

            // Set up real-time updates (refresh tables every 30 seconds)
            setInterval(() => {
                loadSoilMixturesTable();
                loadObservationsTable();
            }, 30000);
        });

        // Accordion functionality
        function toggleAccordion(accordionId) {
            const content = document.getElementById(accordionId + '-content');
            const arrow = document.querySelector(`[onclick="toggleAccordion('${accordionId}')"] .accordion-arrow`);

            if (content.classList.contains('open')) {
                content.classList.remove('open');
                arrow.style.transform = 'rotate(0deg)';
                arrow.textContent = '‚ñº';
            } else {
                content.classList.add('open');
                arrow.style.transform = 'rotate(180deg)';
                arrow.textContent = '‚ñ≤';
            }
        }
    </script>
</body>
</html>